{"version":3,"sources":["websdk-1.4.5.js"],"names":["root","factory","exports","module","define","amd","this","modules","__webpack_require__","moduleId","installedModules","id","loaded","call","m","c","p","_parsePrivacy","iq","list","items","getElementsByTagName","i","length","item","jid","getAttribute","order","type","n","_parseNameFromJidFn","name","_parseGroupBlacklist","affiliation","nick","_setText","valueDom","v","textContent","text","_version","_code","code","_utils","utils","_msg","_message","_msgHash","Queue","window","URL","webkitURL","mozURL","msURL","XDomainRequest","prototype","oldsend","send","apply","arguments","readyState","Strophe","Request","_newXHR","xhr","xmlrequest","overrideMimeType","onreadystatechange","func","bind","Websocket","_closeSocket","socket","me","setTimeout","close","e","_onMessage","message","WebIM","config","isDebug","console","log","ts","data","elem","indexOf","DOMParser","parseFromString","documentElement","see_uri","_conn","_changeConnectStatus","Status","REDIRECT","reset","service","_connect","_doDisconnect","search","_handleStreamStart","_streamWrap","_check_streamerror","ERROR","disconnecting","firstChild","nodeName","xmlInput","rawInput","serialize","_dataRecv","_listenNetwork","onlineCallback","offlineCallback","addEventListener","attachEvent","document","body","_parseRoom","result","rooms","roomJid","tmp","split","room","roomId","push","_parseRoomOccupants","occupants","_parseResponseMessage","msginfo","parseMsgData","errorMsg","msgBodies","msgBody","childNodes","childNode","nodeType","ElementType","TEXT","jsondata","wholeText","nodeValue","replace","eval","delayTags","delayTag","delayMsgTime","delayTimeStamp","childrens","child","domain","tempstr","findex","substring","atindex","_parseFriend","queryTag","conn","from","rouster","subscription","friend","ask","groups","forEachChild","group","getText","subscribe","toJid","subscribed","_login","options","accessToken","access_token","stringify","onError","WEBIM_CONNCTION_OPEN_USERGRID_ERROR","context","accessTokenExpires","expires_in","stropheConn","isOpening","isOpened","getStrophe","callback","status","msg","_loginCallback","route","connect","wait","hold","_parseMessageType","msgtype","receiveinfo","namespaceURI","inviteinfo","_handleMessageQueue","hasOwnProperty","conflict","error","CONNFAIL","WEBIM_CONNCTION_SERVER_CLOSE_ERROR","reconnect","ATTACHED","CONNECTED","intervalId","setInterval","handelSendQueue","handleMessage","handleReceivedMessage","handleInviteMessage","handlePresence","handlePing","handleIqRoster","handleIqPrivacy","handleIq","addHandler","STATUS_OPENED","supportRecMessage","WEBIM_MESSAGE_REC_TEXT","WEBIM_MESSAGE_REC_EMOJI","isCanDownLoadFile","WEBIM_MESSAGE_REC_PHOTO","WEBIM_MESSAGE_REC_AUDIO_FILE","supportSedMessage","WEBIM_MESSAGE_SED_TEXT","isCanUploadFile","notifyVersion","retry","heartBeat","isAutoLogin","setPresence","onOpened","canReceive","canSend","DISCONNECTING","stopHeartBeat","STATUS_CLOSING","DISCONNECTED","Demo","autoReconnectNumTotal","autoReconnectNumMax","WEBIM_CONNCTION_DISCONNECTED","STATUS_CLOSED","clear","onClosed","AUTHFAIL","WEBIM_CONNCTION_AUTH_ERROR","STATUS_ERROR","WEBIM_CONNCTION_SERVER_ERROR","status_now","_getJid","appKey","to","resource","_getJidByName","_validCheck","user","WEBIM_CONNCTION_USER_NOT_ASSIGN_ERROR","devInfos","WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR","orgName","appName","toLowerCase","isMultiLoginSessions","Date","getTime","Math","floor","random","toFixed","userId","_getXmppUrl","baseUrl","https","test","url","prefix","base","suffix","isSupportWss","WebSocket","connection","location","protocol","inactivity","heartBeatWait","maxRetries","pollingTime","autoReconnectInterval","STATUS_INIT","sendQueue","dnsArr","dnsIndex","dnsTotal","restHosts","restIndex","restTotal","xmppHosts","xmppIndex","xmppTotal","pop","sendReceiptsMessage","listen","emptyfn","onTextMessage","onEmojiMessage","onPictureMessage","onAudioMessage","onVideoMessage","onFileMessage","onLocationMessage","onCmdMessage","onPresence","onRoster","onReceivedMessage","onInviteMessage","onOffline","onOnline","onConfirmPop","onUpdateMyGroupList","onUpdateMyRoster","onBlacklistUpdate","isNeed","navigator","userAgent","heartBeatID","ping","clearInterval","dom","$msg","xmlns","sendCommand","tree","cacheReceiptsMessage","isHttpDNS","host","getXmlFirstChild","ip","port","parter","Connection","getHostsByTag","tagName","tag","hosts","getRestFromHttpDNS","apiURL","apiUrl","login","signup","getHttpDNS","self","suc","res","options2","dataType","app_key","encodeURIComponent","success","ajax","EMPTYFN","err","restUrl","userjson","username","password","nickname","userinfo","open","pass","pwd","STATUS_DOLOGIN_IM","restTokenData","error_description","WEBIM_CONNCTION_OPEN_ERROR","STATUS_DOLOGIN_USERGRID","loginJson","grant_type","timestamp","loginfo","attach","WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR","sid","WEBIM_CONNCTION_SESSIONID_NOT_ASSIGN_ERROR","rid","WEBIM_CONNCTION_RID_NOT_ASSIGN_ERROR","wind","reason","isClosed","isClosing","disconnect","handler","ns","fail","$iq","t","up","failFn","ele","WEBIM_CONNCTION_NOTIFYVERSION_ERROR","sendIQ","presence_type","fromUser","toUser","info","fromJid","chatroom","showTags","showTag","show","statusTags","statusTag","priorityTags","priorityTag","priority","destroy","members","member","role","kickedMember","actor","actorNick","kicked","toNick","groupJid","userJid","groupName","original_type","reflectUser","slice","lastIndexOf","getBlacklist","curJid","iqresult","errorCode","errorText","errorBool","textDOM","msgDatas","too","extmsg","ext","chattype","typeEl","bodies","receiveMsg","emojibody","parseTextMessage","Emoji","isemoji","delay","rwidth","rheight","size","width","height","substr","secret","filename","thumb","thumb_secret","file_length","filetype","addr","lat","lng","action","WEBIM_CONNCTION_CALLBACK_INNER_ERROR","mid","rcv","innerHTML","innerText","Function","form","invitemsg","reasonDom","reasonMsg","xmsg","roomid","roomjid","getUniqueId","cdate","offdate","offset","hexd","parseInt","toString","isWindowSDK","doQuery","encodeURI","chatType","response","api","NotifyError","Object","addRoster","removeRoster","getRoster","completeFn","WEBIM_CONNCTION_GETROSTER_ERROR","pres","$pres","unsubscribe","unsubscribed","createRoom","roomiq","roomName","NS","MUC_OWNER","joinPublicGroup","room_nick","errorFn","WEBIM_CONNCTION_JOINROOM_ERROR","MUC","listRooms","server","DISCO_ITEMS","WEBIM_CONNCTION_GETROOM_ERROR","queryRoomMember","mem","WEBIM_CONNCTION_GETROOMMEMBER_ERROR","queryRoomInfo","DISCO_INFO","settings","features","fields","fieldValues","field","fieldVar","fieldSimplify","WEBIM_CONNCTION_GETROOMINFO_ERROR","queryRoomOccupants","WEBIM_CONNCTION_GETROOMOCCUPANTS_ERROR","attrs","setUserSig","desc","getPresence","WEBIM_CONNCTION_PING_ERROR","key","errorType","statusCode","WEBIM_CONNCTION_CLIENT_LOGOUT","init","getChatRooms","isCanSetRequestHeader","WEBIM_CONNCTION_NOT_SUPPORT_CHATROOM_ERROR","token","WEBIM_CONNCTION_LOAD_CHATROOM_ERROR","pageInfo","pagenum","pagesize","opts","headers","Authorization","joinChatRoom","WEBIM_CONNCTION_JOINCHATROOM_ERROR","quitChatRoom","WEBIM_CONNCTION_QUITCHATROOM_ERROR","_onReceiveInviteFromGroup","title","group_id","agree","reject","_onReceiveInviteAcceptionFromGroup","_onReceiveInviteDeclineFromGroup","_onAutoAcceptInvitationFromGroup","group_name","_onLeaveGroup","_onReceiveJoinGroupApplication","_onReceiveAcceptionFromGroup","_onReceiveRejectionFromGroup","_onUpdateMyGroupList","_onUpdateMyRoster","that","closed","sucFn","errFn","addToBlackList","blacklist","piece","keys","len","value","removeFromBlackList","_getGroupJid","addToGroupBlackList","getGroupBlacklist","removeGroupMemberFromBlacklist","changeGroupSubject","var","subject","description","destroyGroup","leaveGroupBySelf","msgInfo","errInfo","leaveGroup","addGroupMembers","acceptInviteFromGroup","rejectInviteFromGroup","createGroup","toRoom","x","setAttribute","optionsPublic","optionsMembersOnly","optionsModerate","optionsAllowInvites","cnode","str","cefQuery","request","persistent","onSuccess","onFailure","connIndex","uploadIndex","downloadIndex","msgIndex","statusIndex","WEBIM_CONNCTION_ATTACH_ERROR","WEBIM_CONNCTION_ATTACH_USERGRID_ERROR","WEBIM_CONNCTION_REOPEN_ERROR","WEBIM_CONNCTION_IQ_ERROR","WEBIM_CONNCTION_CROSSDOMAIN_ERROR","WEBIM_CONNCTION_LISTENING_OUTOF_MAXRETRIES","WEBIM_CONNCTION_RECEIVEMSG_CONTENTERROR","WEBIM_CONNCTION_AJAX_ERROR","WEBIM_CONNCTION_CLIENT_OFFLINE","WEBIM_CONNCTION_CLIENT_TOO_MUCH_ERROR","WEBIM_UPLOADFILE_BROWSER_ERROR","WEBIM_UPLOADFILE_ERROR","WEBIM_UPLOADFILE_NO_LOGIN","WEBIM_UPLOADFILE_NO_FILE","WEBIM_DOWNLOADFILE_ERROR","WEBIM_DOWNLOADFILE_NO_LOGIN","WEBIM_DOWNLOADFILE_BROWSER_ERROR","WEBIM_MESSAGE_REC_TEXT_ERROR","WEBIM_MESSAGE_REC_EMOTION","WEBIM_MESSAGE_REC_AUDIO","WEBIM_MESSAGE_REC_VEDIO","WEBIM_MESSAGE_REC_VEDIO_FILE","WEBIM_MESSAGE_REC_FILE","WEBIM_MESSAGE_SED_EMOTION","WEBIM_MESSAGE_SED_PHOTO","WEBIM_MESSAGE_SED_AUDIO","WEBIM_MESSAGE_SED_AUDIO_FILE","WEBIM_MESSAGE_SED_VEDIO","WEBIM_MESSAGE_SED_VEDIO_FILE","WEBIM_MESSAGE_SED_FILE","WEBIM_FILESIZE_LIMIT","_createStandardXHR","XMLHttpRequest","_createActiveXHR","ActiveXObject","_xmlrequest","crossDomain","temp","onload","xmlDoc","async","loadXML","responseText","responseXML","ontimeout","onerror","_hasFlash","ex","plugins","_tmpUtilXHR","_hasFormData","FormData","_hasBlob","Blob","_isCanSetRequestHeader","setRequestHeader","_hasOverrideMimeType","_isCanUploadFileAsync","_isCanUploadFile","_isCanDownLoadFile","hasDontEnumBug","propertyIsEnumerable","dontEnums","dontEnumsLength","obj","TypeError","prop","hasFormData","hasBlob","hasOverrideMimeType","isCanUploadFileAsync","notSupportList","ua","l","getIEVersion","matches","tridentMap","4","5","6","7","match","json","JSON","s","arr","iterate","isArr","o","registerUser","getFileUrl","fileInputId","uri","fileObj","getElementById","createObjectURL","fileItems","files","u","pos1","pos2","pos","max","index","getFileSize","file","fileSize","select","fileobject","GetFile","Size","hasFlash","trim","parseEmoji","map","emoji","face","path","parseLink","reg","parseJSON","parse","requireNonComma","depth","comma","parseUploadResponse","parseDownloadResponse","uploadFile","onFileUploadProgress","onFileUploadComplete","onFileUploadError","onFileUploadCanceled","acc","uploadUrl","flashUpload","undefined","upload","abort","formData","append","download","onFileDownloadComplete","onFileDownloadError","method","resType","responseType","mimeType","innerHeaer","X-Requested-With","Accept","share-secret","faces","emessage","expr","tmsg","existEmoji","emojiStr","restMsgIndex","children","tempData","d","Hours","getHours","Minutes","getMinutes","Seconds","getSeconds","Milliseconds","getMilliseconds","getObjectKey","val","Message","setGroup","txt","set","opt","roomType","cmd","img","uploadError","uploadComplete","audio","video","_Message","_send","weichat","originType","jsonstr","_tmpComplete","_complete","entities","file_len","thumbnail","Array_h","array","Array","at","start","end","concat","remove","count","splice","join","separator","_array_h","_index","ret","head","tail","empty"],"mappings":"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","file":"websdk-1.4.5.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"WebIM\"] = factory();\n\telse\n\t\troot[\"WebIM\"] = factory();\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n\n\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tmodule.exports = __webpack_require__(1)\n\n\n/***/ },\n/* 1 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar _version = '1.4.2';\n\tvar _code = __webpack_require__(2).code;\n\tvar _utils = __webpack_require__(3).utils;\n\tvar _msg = __webpack_require__(4);\n\tvar _message = _msg._msg;\n\tvar _msgHash = {};\n\tvar Queue = __webpack_require__(5).Queue;\n\n\twindow.URL = window.URL || window.webkitURL || window.mozURL || window.msURL;\n\n\tif (window.XDomainRequest) {\n\t    XDomainRequest.prototype.oldsend = XDomainRequest.prototype.send;\n\t    XDomainRequest.prototype.send = function () {\n\t        XDomainRequest.prototype.oldsend.apply(this, arguments);\n\t        this.readyState = 2;\n\t    };\n\t}\n\n\tStrophe.Request.prototype._newXHR = function () {\n\t    var xhr = _utils.xmlrequest(true);\n\t    if (xhr.overrideMimeType) {\n\t        xhr.overrideMimeType('text/xml');\n\t    }\n\t    // use Function.bind() to prepend ourselves as an argument\n\t    xhr.onreadystatechange = this.func.bind(null, this);\n\t    return xhr;\n\t};\n\n\tStrophe.Websocket.prototype._closeSocket = function () {\n\t    if (this.socket) {\n\t        var me = this;\n\t        setTimeout(function () {\n\t            try {\n\t                me.socket.close();\n\t            } catch (e) {\n\t            }\n\t        }, 0);\n\t    } else {\n\t        this.socket = null;\n\t    }\n\t};\n\n\t/**\n\t *\n\t * Strophe.Websocket has a bug while logout:\n\t * 1.send: <presence xmlns='jabber:client' type='unavailable'/> is ok;\n\t * 2.send: <close xmlns='urn:ietf:params:xml:ns:xmpp-framing'/> will cause a problem,log as follows:\n\t * WebSocket connection to 'ws://im-api.easemob.com/ws/' failed: Data frame received after close_connect @ strophe.js:5292connect @ strophe.js:2491_login @ websdk-1.1.2.js:278suc @ websdk-1.1.2.js:636xhr.onreadystatechange @ websdk-1.1.2.js:2582\n\t * 3 \"Websocket error [object Event]\"\n\t * _changeConnectStatus\n\t * onError Object {type: 7, msg: \"The WebSocket connection could not be established or was disconnected.\", reconnect: true}\n\t *\n\t * this will trigger socket.onError, therefore _doDisconnect again.\n\t * Fix it by overide  _onMessage\n\t */\n\tStrophe.Websocket.prototype._onMessage = function (message) {\n\t    WebIM && WebIM.config.isDebug && console.log(WebIM.utils.ts() + 'recv:', message.data);\n\t    var elem, data;\n\t    // check for closing stream\n\t    // var close = '<close xmlns=\"urn:ietf:params:xml:ns:xmpp-framing\" />';\n\t    // if (message.data === close) {\n\t    //     this._conn.rawInput(close);\n\t    //     this._conn.xmlInput(message);\n\t    //     if (!this._conn.disconnecting) {\n\t    //         this._conn._doDisconnect();\n\t    //     }\n\t    //     return;\n\t    //\n\t    // send and receive close xml: <close xmlns='urn:ietf:params:xml:ns:xmpp-framing'/>\n\t    // so we can't judge whether message.data equals close by === simply.\n\t    if (message.data.indexOf(\"<close \") === 0) {\n\t        elem = new DOMParser().parseFromString(message.data, \"text/xml\").documentElement;\n\t        var see_uri = elem.getAttribute(\"see-other-uri\");\n\t        if (see_uri) {\n\t            this._conn._changeConnectStatus(Strophe.Status.REDIRECT, \"Received see-other-uri, resetting connection\");\n\t            this._conn.reset();\n\t            this._conn.service = see_uri;\n\t            this._connect();\n\t        } else {\n\t            // if (!this._conn.disconnecting) {\n\t            this._conn._doDisconnect(\"receive <close> from server\");\n\t            // }\n\t        }\n\t        return;\n\t    } else if (message.data.search(\"<open \") === 0) {\n\t        // This handles stream restarts\n\t        elem = new DOMParser().parseFromString(message.data, \"text/xml\").documentElement;\n\t        if (!this._handleStreamStart(elem)) {\n\t            return;\n\t        }\n\t    } else {\n\t        data = this._streamWrap(message.data);\n\t        elem = new DOMParser().parseFromString(data, \"text/xml\").documentElement;\n\t    }\n\n\t    if (this._check_streamerror(elem, Strophe.Status.ERROR)) {\n\t        return;\n\t    }\n\n\t    //handle unavailable presence stanza before disconnecting\n\t    if (this._conn.disconnecting &&\n\t        elem.firstChild.nodeName === \"presence\" &&\n\t        elem.firstChild.getAttribute(\"type\") === \"unavailable\") {\n\t        this._conn.xmlInput(elem);\n\t        this._conn.rawInput(Strophe.serialize(elem));\n\t        // if we are already disconnecting we will ignore the unavailable stanza and\n\t        // wait for the </stream:stream> tag before we close the connection\n\t        return;\n\t    }\n\t    this._conn._dataRecv(elem, message.data);\n\t};\n\n\n\tvar _listenNetwork = function (onlineCallback, offlineCallback) {\n\n\t    if (window.addEventListener) {\n\t        window.addEventListener('online', onlineCallback);\n\t        window.addEventListener('offline', offlineCallback);\n\n\t    } else if (window.attachEvent) {\n\t        if (document.body) {\n\t            document.body.attachEvent('ononline', onlineCallback);\n\t            document.body.attachEvent('onoffline', offlineCallback);\n\t        } else {\n\t            window.attachEvent('load', function () {\n\t                document.body.attachEvent('ononline', onlineCallback);\n\t                document.body.attachEvent('onoffline', offlineCallback);\n\t            });\n\t        }\n\t    } else {\n\t        /*var onlineTmp = window.ononline;\n\t         var offlineTmp = window.onoffline;\n\n\t         window.attachEvent('ononline', function () {\n\t         try {\n\t         typeof onlineTmp === 'function' && onlineTmp();\n\t         } catch ( e ) {}\n\t         onlineCallback();\n\t         });\n\t         window.attachEvent('onoffline', function () {\n\t         try {\n\t         typeof offlineTmp === 'function' && offlineTmp();\n\t         } catch ( e ) {}\n\t         offlineCallback();\n\t         });*/\n\t    }\n\t};\n\n\tvar _parseRoom = function (result) {\n\t    var rooms = [];\n\t    var items = result.getElementsByTagName('item');\n\t    if (items) {\n\t        for (var i = 0; i < items.length; i++) {\n\t            var item = items[i];\n\t            var roomJid = item.getAttribute('jid');\n\t            var tmp = roomJid.split('@')[0];\n\t            var room = {\n\t                jid: roomJid,\n\t                name: item.getAttribute('name'),\n\t                roomId: tmp.split('_')[1]\n\t            };\n\t            rooms.push(room);\n\t        }\n\t    }\n\t    return rooms;\n\t};\n\n\tvar _parseRoomOccupants = function (result) {\n\t    var occupants = [];\n\t    var items = result.getElementsByTagName('item');\n\t    if (items) {\n\t        for (var i = 0; i < items.length; i++) {\n\t            var item = items[i];\n\t            var room = {\n\t                jid: item.getAttribute('jid'),\n\t                name: item.getAttribute('name')\n\t            };\n\t            occupants.push(room);\n\t        }\n\t    }\n\t    return occupants;\n\t};\n\n\tvar _parseResponseMessage = function (msginfo) {\n\t    var parseMsgData = {errorMsg: true, data: []};\n\n\t    var msgBodies = msginfo.getElementsByTagName('body');\n\t    if (msgBodies) {\n\t        for (var i = 0; i < msgBodies.length; i++) {\n\t            var msgBody = msgBodies[i];\n\t            var childNodes = msgBody.childNodes;\n\t            if (childNodes && childNodes.length > 0) {\n\t                var childNode = msgBody.childNodes[0];\n\t                if (childNode.nodeType == Strophe.ElementType.TEXT) {\n\t                    var jsondata = childNode.wholeText || childNode.nodeValue;\n\t                    jsondata = jsondata.replace('\\n', '<br>');\n\t                    try {\n\t                        var data = eval('(' + jsondata + ')');\n\t                        parseMsgData.errorMsg = false;\n\t                        parseMsgData.data = [data];\n\t                    } catch (e) {\n\t                    }\n\t                }\n\t            }\n\t        }\n\n\t        var delayTags = msginfo.getElementsByTagName('delay');\n\t        if (delayTags && delayTags.length > 0) {\n\t            var delayTag = delayTags[0];\n\t            var delayMsgTime = delayTag.getAttribute('stamp');\n\t            if (delayMsgTime) {\n\t                parseMsgData.delayTimeStamp = delayMsgTime;\n\t            }\n\t        }\n\t    } else {\n\t        var childrens = msginfo.childNodes;\n\t        if (childrens && childrens.length > 0) {\n\t            var child = msginfo.childNodes[0];\n\t            if (child.nodeType == Strophe.ElementType.TEXT) {\n\t                try {\n\t                    var data = eval('(' + child.nodeValue + ')');\n\t                    parseMsgData.errorMsg = false;\n\t                    parseMsgData.data = [data];\n\t                } catch (e) {\n\t                }\n\t            }\n\t        }\n\t    }\n\t    return parseMsgData;\n\t};\n\n\tvar _parseNameFromJidFn = function (jid, domain) {\n\t    domain = domain || '';\n\t    var tempstr = jid;\n\t    var findex = tempstr.indexOf('_');\n\n\t    if (findex !== -1) {\n\t        tempstr = tempstr.substring(findex + 1);\n\t    }\n\t    var atindex = tempstr.indexOf('@' + domain);\n\t    if (atindex !== -1) {\n\t        tempstr = tempstr.substring(0, atindex);\n\t    }\n\t    return tempstr;\n\t};\n\n\tvar _parseFriend = function (queryTag, conn, from) {\n\t    var rouster = [];\n\t    var items = queryTag.getElementsByTagName('item');\n\t    if (items) {\n\t        for (var i = 0; i < items.length; i++) {\n\t            var item = items[i];\n\t            var jid = item.getAttribute('jid');\n\t            if (!jid) {\n\t                continue;\n\t            }\n\t            var subscription = item.getAttribute('subscription');\n\t            var friend = {\n\t                subscription: subscription,\n\t                jid: jid\n\t            };\n\t            var ask = item.getAttribute('ask');\n\t            if (ask) {\n\t                friend.ask = ask;\n\t            }\n\t            var name = item.getAttribute('name');\n\t            if (name) {\n\t                friend.name = name;\n\t            } else {\n\t                var n = _parseNameFromJidFn(jid);\n\t                friend.name = n;\n\t            }\n\t            var groups = [];\n\t            Strophe.forEachChild(item, 'group', function (group) {\n\t                groups.push(Strophe.getText(group));\n\t            });\n\t            friend.groups = groups;\n\t            rouster.push(friend);\n\t            // B同意之后 -> B订阅A\n\t            if (conn && (subscription == 'from')) {\n\t                conn.subscribe({\n\t                    toJid: jid\n\t                });\n\t            }\n\n\t            if (conn && (subscription == 'to')) {\n\t                conn.subscribed({\n\t                    toJid: jid\n\t                });\n\t            }\n\t        }\n\t    }\n\t    return rouster;\n\t};\n\n\tvar _login = function (options, conn) {\n\t    var accessToken = options.access_token || '';\n\t    if (accessToken == '') {\n\t        var loginfo = _utils.stringify(options);\n\t        conn.onError({\n\t            type: _code.WEBIM_CONNCTION_OPEN_USERGRID_ERROR,\n\t            data: options\n\t        });\n\t        return;\n\t    }\n\t    conn.context.accessToken = options.access_token;\n\t    conn.context.accessTokenExpires = options.expires_in;\n\t    var stropheConn = null;\n\t    if (conn.isOpening() && conn.context.stropheConn) {\n\t        stropheConn = conn.context.stropheConn;\n\t    } else if (conn.isOpened() && conn.context.stropheConn) {\n\t        // return;\n\t        stropheConn = conn.getStrophe();\n\t    } else {\n\t        stropheConn = conn.getStrophe();\n\t    }\n\t    var callback = function (status, msg) {\n\t        _loginCallback(status, msg, conn);\n\t    };\n\n\t    conn.context.stropheConn = stropheConn;\n\t    if (conn.route) {\n\t        stropheConn.connect(conn.context.jid, '$t$' + accessToken, callback, conn.wait, conn.hold, conn.route);\n\t    } else {\n\t        stropheConn.connect(conn.context.jid, '$t$' + accessToken, callback, conn.wait, conn.hold);\n\t    }\n\t};\n\n\tvar _parseMessageType = function (msginfo) {\n\t    var msgtype = 'normal';\n\t    var receiveinfo = msginfo.getElementsByTagName('received');\n\t    if (receiveinfo && receiveinfo.length > 0 && receiveinfo[0].namespaceURI === 'urn:xmpp:receipts') {\n\t        msgtype = 'received';\n\t    } else {\n\t        var inviteinfo = msginfo.getElementsByTagName('invite');\n\t        if (inviteinfo && inviteinfo.length > 0) {\n\t            msgtype = 'invite';\n\t        }\n\t    }\n\t    return msgtype;\n\t};\n\n\tvar _handleMessageQueue = function (conn) {\n\t    for (var i in _msgHash) {\n\t        if (_msgHash.hasOwnProperty(i)) {\n\t            _msgHash[i].send(conn);\n\t        }\n\t    }\n\t};\n\n\tvar _loginCallback = function (status, msg, conn) {\n\t    var conflict, error;\n\n\t    if (msg === 'conflict') {\n\t        conflict = true;\n\t    }\n\n\t    if (status == Strophe.Status.CONNFAIL) {\n\t        //client offline, ping/pong timeout, server quit, server offline\n\t        error = {\n\t            type: _code.WEBIM_CONNCTION_SERVER_CLOSE_ERROR,\n\t            msg: msg,\n\t            reconnect: true\n\t        };\n\n\t        conflict && (error.conflict = true);\n\t        conn.onError(error);\n\t    } else if (status == Strophe.Status.ATTACHED || status == Strophe.Status.CONNECTED) {\n\t        // client should limit the speed of sending ack messages  up to 5/s\n\t        conn.intervalId = setInterval(function () {\n\t            conn.handelSendQueue();\n\t        }, 200);\n\t        var handleMessage = function (msginfo) {\n\t            var type = _parseMessageType(msginfo);\n\n\t            if ('received' === type) {\n\t                conn.handleReceivedMessage(msginfo);\n\t                return true;\n\t            } else if ('invite' === type) {\n\t                conn.handleInviteMessage(msginfo);\n\t                return true;\n\t            } else {\n\t                conn.handleMessage(msginfo);\n\t                return true;\n\t            }\n\t        };\n\t        var handlePresence = function (msginfo) {\n\t            conn.handlePresence(msginfo);\n\t            return true;\n\t        };\n\t        var handlePing = function (msginfo) {\n\t            conn.handlePing(msginfo);\n\t            return true;\n\t        };\n\t        var handleIqRoster = function (msginfo) {\n\t            conn.handleIqRoster(msginfo);\n\t            return true;\n\t        };\n\t        var handleIqPrivacy = function (msginfo) {\n\t            conn.handleIqPrivacy(msginfo);\n\t            return true;\n\t        };\n\t        var handleIq = function (msginfo) {\n\t            conn.handleIq(msginfo);\n\t            return true;\n\t        };\n\n\t        conn.addHandler(handleMessage, null, 'message', null, null, null);\n\t        conn.addHandler(handlePresence, null, 'presence', null, null, null);\n\t        conn.addHandler(handlePing, 'urn:xmpp:ping', 'iq', 'get', null, null);\n\t        conn.addHandler(handleIqRoster, 'jabber:iq:roster', 'iq', 'set', null, null);\n\t        conn.addHandler(handleIqPrivacy, 'jabber:iq:privacy', 'iq', 'set', null, null);\n\t        conn.addHandler(handleIq, null, 'iq', null, null, null);\n\n\t        conn.context.status = _code.STATUS_OPENED;\n\n\t        var supportRecMessage = [\n\t            _code.WEBIM_MESSAGE_REC_TEXT,\n\t            _code.WEBIM_MESSAGE_REC_EMOJI];\n\n\t        if (_utils.isCanDownLoadFile) {\n\t            supportRecMessage.push(_code.WEBIM_MESSAGE_REC_PHOTO);\n\t            supportRecMessage.push(_code.WEBIM_MESSAGE_REC_AUDIO_FILE);\n\t        }\n\t        var supportSedMessage = [_code.WEBIM_MESSAGE_SED_TEXT];\n\t        if (_utils.isCanUploadFile) {\n\t            supportSedMessage.push(_code.WEBIM_MESSAGE_REC_PHOTO);\n\t            supportSedMessage.push(_code.WEBIM_MESSAGE_REC_AUDIO_FILE);\n\t        }\n\t        conn.notifyVersion();\n\t        conn.retry && _handleMessageQueue(conn);\n\t        conn.heartBeat();\n\t        conn.isAutoLogin && conn.setPresence();\n\t        conn.onOpened({\n\t            canReceive: supportRecMessage,\n\t            canSend: supportSedMessage,\n\t            accessToken: conn.context.accessToken\n\t        });\n\t    } else if (status == Strophe.Status.DISCONNECTING) {\n\t        if (conn.isOpened()) {\n\t            conn.stopHeartBeat();\n\t            conn.context.status = _code.STATUS_CLOSING;\n\n\t            error = {\n\t                type: _code.WEBIM_CONNCTION_SERVER_CLOSE_ERROR,\n\t                msg: msg,\n\t                reconnect: true\n\t            };\n\n\t            conflict && (error.conflict = true);\n\t            conn.onError(error);\n\t        }\n\t    } else if (status == Strophe.Status.DISCONNECTED) {\n\t        if (conn.isOpened()) {\n\t            if (Demo.conn.autoReconnectNumTotal < Demo.conn.autoReconnectNumMax) {\n\t                Demo.conn.reconnect();\n\t                return;\n\t            } else {\n\t                error = {\n\t                    type: _code.WEBIM_CONNCTION_DISCONNECTED\n\t                };\n\t                conn.onError(error);\n\t            }\n\t        }\n\t        conn.context.status = _code.STATUS_CLOSED;\n\t        conn.clear();\n\t        conn.onClosed();\n\t    } else if (status == Strophe.Status.AUTHFAIL) {\n\t        error = {\n\t            type: _code.WEBIM_CONNCTION_AUTH_ERROR\n\t        };\n\n\t        conflict && (error.conflict = true);\n\t        conn.onError(error);\n\t        conn.clear();\n\t    } else if (status == Strophe.Status.ERROR) {\n\t        conn.context.status = _code.STATUS_ERROR;\n\t        error = {\n\t            type: _code.WEBIM_CONNCTION_SERVER_ERROR\n\t        };\n\n\t        conflict && (error.conflict = true);\n\t        conn.onError(error);\n\t    }\n\t    conn.context.status_now = status;\n\t};\n\n\tvar _getJid = function (options, conn) {\n\t    var jid = options.toJid || '';\n\n\t    if (jid === '') {\n\t        var appKey = conn.context.appKey || '';\n\t        var toJid = appKey + '_' + options.to + '@' + conn.domain;\n\n\t        if (options.resource) {\n\t            toJid = toJid + '/' + options.resource;\n\t        }\n\t        jid = toJid;\n\t    }\n\t    return jid;\n\t};\n\n\tvar _getJidByName = function (name, conn) {\n\t    var options = {\n\t        to: name\n\t    };\n\t    return _getJid(options, conn);\n\t};\n\n\tvar _validCheck = function (options, conn) {\n\t    options = options || {};\n\n\t    if (options.user == '') {\n\t        conn.onError({\n\t            type: _code.WEBIM_CONNCTION_USER_NOT_ASSIGN_ERROR\n\t        });\n\t        return false;\n\t    }\n\n\t    var user = (options.user + '') || '';\n\t    var appKey = options.appKey || '';\n\t    var devInfos = appKey.split('#');\n\n\t    if (devInfos.length !== 2) {\n\t        conn.onError({\n\t            type: _code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR\n\t        });\n\t        return false;\n\t    }\n\t    var orgName = devInfos[0];\n\t    var appName = devInfos[1];\n\n\t    if (!orgName) {\n\t        conn.onError({\n\t            type: _code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR\n\t        });\n\t        return false;\n\t    }\n\t    if (!appName) {\n\t        conn.onError({\n\t            type: _code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR\n\t        });\n\t        return false;\n\t    }\n\n\t    var jid = appKey + '_' + user.toLowerCase() + '@' + conn.domain,\n\t        resource = options.resource || 'webim';\n\n\t    if (conn.isMultiLoginSessions) {\n\t        resource += user + new Date().getTime() + Math.floor(Math.random().toFixed(6) * 1000000);\n\t    }\n\t    conn.context.jid = jid + '/' + resource;\n\t    /*jid: {appkey}_{username}@domain/resource*/\n\t    conn.context.userId = user;\n\t    conn.context.appKey = appKey;\n\t    conn.context.appName = appName;\n\t    conn.context.orgName = orgName;\n\n\t    return true;\n\t};\n\n\tvar _getXmppUrl = function (baseUrl, https) {\n\t    if (/^(ws|http)s?:\\/\\/?/.test(baseUrl)) {\n\t        return baseUrl;\n\t    }\n\n\t    var url = {\n\t        prefix: 'http',\n\t        base: '://' + baseUrl,\n\t        suffix: '/http-bind/'\n\t    };\n\n\t    if (https && _utils.isSupportWss) {\n\t        url.prefix = 'wss';\n\t        url.suffix = '/ws/';\n\t    } else {\n\t        if (https) {\n\t            url.prefix = 'https';\n\t        } else if (window.WebSocket) {\n\t            url.prefix = 'ws';\n\t            url.suffix = '/ws/';\n\t        }\n\t    }\n\n\t    return url.prefix + url.base + url.suffix;\n\t};\n\n\n\t//class\n\tvar connection = function (options) {\n\t    if (!this instanceof connection) {\n\t        return new connection(options);\n\t    }\n\n\t    var options = options || {};\n\n\t    this.isMultiLoginSessions = options.isMultiLoginSessions || false;\n\t    this.wait = options.wait || 30;\n\t    this.retry = options.retry || false;\n\t    this.https = options.https || location.protocol === 'https:';\n\t    this.url = _getXmppUrl(options.url, this.https);\n\t    this.hold = options.hold || 1;\n\t    this.route = options.route || null;\n\t    this.domain = options.domain || 'easemob.com';\n\t    this.inactivity = options.inactivity || 30;\n\t    this.heartBeatWait = options.heartBeatWait || 4500;\n\t    this.maxRetries = options.maxRetries || 5;\n\t    this.isAutoLogin = options.isAutoLogin === false ? false : true;\n\t    this.pollingTime = options.pollingTime || 800;\n\t    this.stropheConn = false;\n\t    this.autoReconnectNumMax = options.autoReconnectNumMax || 0;\n\t    this.autoReconnectNumTotal = 0;\n\t    this.autoReconnectInterval = options.autoReconnectInterval || 0;\n\t    this.context = {status: _code.STATUS_INIT};\n\t    this.sendQueue = new Queue();  //instead of sending message immediately,cache them in this queue\n\t    this.intervalId = null;   //clearInterval return value\n\n\t    this.dnsArr = ['https://rs.easemob.com', 'https://rsbak.easemob.com', 'http://182.92.174.78', 'http://112.126.66.111']; //http dns server hosts\n\t    this.dnsIndex = 0;   //the dns ip used in dnsArr currently\n\t    this.dnsTotal = this.dnsArr.length;  //max number of getting dns retries\n\t    this.restHosts = null; //rest server ips\n\t    this.restIndex = 0;    //the rest ip used in restHosts currently\n\t    this.restTotal = 0;    //max number of getting rest token retries\n\t    this.xmppHosts = null; //xmpp server ips\n\t    this.xmppIndex = 0;    //the xmpp ip used in xmppHosts currently\n\t    this.xmppTotal = 0;    //max number of creating xmpp server connection(ws/bosh) retries\n\t};\n\n\tconnection.prototype.handelSendQueue = function () {\n\t    var options = this.sendQueue.pop();\n\t    if (options !== null) {\n\t        this.sendReceiptsMessage(options);\n\t    }\n\t};\n\tconnection.prototype.listen = function (options) {\n\t    this.onOpened = options.onOpened || _utils.emptyfn;\n\t    this.onClosed = options.onClosed || _utils.emptyfn;\n\t    this.onTextMessage = options.onTextMessage || _utils.emptyfn;\n\t    this.onEmojiMessage = options.onEmojiMessage || _utils.emptyfn;\n\t    this.onPictureMessage = options.onPictureMessage || _utils.emptyfn;\n\t    this.onAudioMessage = options.onAudioMessage || _utils.emptyfn;\n\t    this.onVideoMessage = options.onVideoMessage || _utils.emptyfn;\n\t    this.onFileMessage = options.onFileMessage || _utils.emptyfn;\n\t    this.onLocationMessage = options.onLocationMessage || _utils.emptyfn;\n\t    this.onCmdMessage = options.onCmdMessage || _utils.emptyfn;\n\t    this.onPresence = options.onPresence || _utils.emptyfn;\n\t    this.onRoster = options.onRoster || _utils.emptyfn;\n\t    this.onError = options.onError || _utils.emptyfn;\n\t    this.onReceivedMessage = options.onReceivedMessage || _utils.emptyfn;\n\t    this.onInviteMessage = options.onInviteMessage || _utils.emptyfn;\n\t    this.onOffline = options.onOffline || _utils.emptyfn;\n\t    this.onOnline = options.onOnline || _utils.emptyfn;\n\t    this.onConfirmPop = options.onConfirmPop || _utils.emptyfn;\n\t    //for WindowSDK start\n\t    this.onUpdateMyGroupList = options.onUpdateMyGroupList || _utils.emptyfn;\n\t    this.onUpdateMyRoster = options.onUpdateMyRoster || _utils.emptyfn;\n\t    //for WindowSDK end\n\t    this.onBlacklistUpdate = options.onBlacklistUpdate || _utils.emptyfn;\n\n\t    _listenNetwork(this.onOnline, this.onOffline);\n\t};\n\n\tconnection.prototype.heartBeat = function () {\n\t    var me = this;\n\t    //IE8: strophe auto switch from ws to BOSH, need heartbeat\n\t    var isNeed = !/^ws|wss/.test(me.url) || /mobile/.test(navigator.userAgent);\n\n\t    if (this.heartBeatID || !isNeed) {\n\t        return;\n\t    }\n\n\t    var options = {\n\t        toJid: this.domain,\n\t        type: 'normal'\n\t    };\n\t    this.heartBeatID = setInterval(function () {\n\t        me.ping(options);\n\t    }, this.heartBeatWait);\n\t};\n\n\tconnection.prototype.stopHeartBeat = function () {\n\t    if (typeof this.heartBeatID == \"number\") {\n\t        this.heartBeatID = clearInterval(this.heartBeatID);\n\t    }\n\t};\n\n\tconnection.prototype.sendReceiptsMessage = function (options) {\n\t    var dom = $msg({\n\t        from: this.context.jid || '',\n\t        to: this.domain,\n\t        id: options.id || ''\n\t    }).c('received', {\n\t        xmlns: 'urn:xmpp:receipts',\n\t        id: options.id || ''\n\t    });\n\t    this.sendCommand(dom.tree());\n\t};\n\n\tconnection.prototype.cacheReceiptsMessage = function (options) {\n\t    this.sendQueue.push(options);\n\t};\n\n\tconnection.prototype.getStrophe = function () {\n\t    if (location.protocol != 'https:' && WebIM.config.isHttpDNS) {\n\t        //TODO: try this.xmppTotal times on fail\n\t        var url = '';\n\t        var host = this.xmppHosts[this.xmppIndex];\n\t        var domain = _utils.getXmlFirstChild(host, 'domain');\n\t        var ip = _utils.getXmlFirstChild(host, 'ip');\n\t        if (ip) {\n\t            url = ip.textContent;\n\t            var port = _utils.getXmlFirstChild(host, 'port');\n\t            if (port.textContent != '80') {\n\t                url += ':' + port.textContent;\n\t            }\n\t        } else {\n\t            url = domain.textContent;\n\t        }\n\n\t        if (url != '') {\n\t            var parter = /(.+\\/\\/).+(\\/.+)/;\n\t            this.url = this.url.replace(parter, \"$1\" + url + \"$2\");\n\t        }\n\t    }\n\n\t    var stropheConn = new Strophe.Connection(this.url, {\n\t        inactivity: this.inactivity,\n\t        maxRetries: this.maxRetries,\n\t        pollingTime: this.pollingTime\n\t    });\n\t    return stropheConn;\n\t};\n\tconnection.prototype.getHostsByTag = function (data, tagName) {\n\t    var tag = _utils.getXmlFirstChild(data, tagName);\n\t    if (!tag) {\n\t        console.log(tagName + ' hosts error');\n\t        return null;\n\t    }\n\t    var hosts = tag.getElementsByTagName('hosts');\n\t    if (hosts.length == 0) {\n\t        console.log(tagName + ' hosts error2');\n\t        return null;\n\t    }\n\t    return hosts[0].getElementsByTagName('host');\n\n\t};\n\tconnection.prototype.getRestFromHttpDNS = function (options, type) {\n\t    if (this.restIndex > this.restTotal) {\n\t        console.log('rest hosts all tried,quit');\n\t        return;\n\t    }\n\t    var url = '';\n\t    var host = this.restHosts[this.restIndex];\n\t    var domain = _utils.getXmlFirstChild(host, 'domain');\n\t    var ip = _utils.getXmlFirstChild(host, 'ip');\n\t    if (ip) {\n\t        var port = _utils.getXmlFirstChild(host, 'port');\n\t        url = (location.protocol === 'https:' ? 'https:' : 'http:') + '//' + ip.textContent + ':' + port.textContent;\n\t    } else {\n\t        url = (location.protocol === 'https:' ? 'https:' : 'http:') + '//' + domain.textContent;\n\t    }\n\n\t    if (url != '') {\n\t        WebIM.config.apiURL = url;\n\t        options.apiUrl = url;\n\t    }\n\n\t    if (type == 'login') {\n\t        this.login(options);\n\t    } else {\n\t        this.signup(options);\n\t    }\n\t};\n\n\tconnection.prototype.getHttpDNS = function (options, type) {\n\t    if (this.restHosts) {\n\t        this.getRestFromHttpDNS(options, type);\n\t        return;\n\t    }\n\t    var self = this;\n\t    var suc = function (data, xhr) {\n\t        data = new DOMParser().parseFromString(data, \"text/xml\").documentElement;\n\t        //get rest ips\n\t        var restHosts = self.getHostsByTag(data, 'rest');\n\t        if (!restHosts) {\n\t            console.log('rest hosts error3');\n\t            return;\n\t        }\n\t        self.restHosts = restHosts;\n\t        self.restTotal = restHosts.length;\n\n\t        //get xmpp ips\n\t        var xmppHosts = self.getHostsByTag(data, 'xmpp');\n\t        if (!xmppHosts) {\n\t            console.log('xmpp hosts error3');\n\t            return;\n\t        }\n\t        self.xmppHosts = xmppHosts;\n\t        self.xmppTotal = xmppHosts.length;\n\n\t        self.getRestFromHttpDNS(options, type);\n\t    };\n\t    var error = function (res, xhr, msg) {\n\n\t        console.log('getHttpDNS error', res, msg);\n\t        self.dnsIndex++;\n\t        if (self.dnsIndex < self.dnsTotal) {\n\t            self.getHttpDNS(options, type);\n\t        }\n\n\t    };\n\t    var options2 = {\n\t        url: this.dnsArr[this.dnsIndex] + '/easemob/server.xml',\n\t        dataType: 'text',\n\t        type: 'GET',\n\n\t        // url: 'http://www.easemob.com/easemob/server.xml',\n\t        // dataType: 'xml',\n\t        data: {app_key: encodeURIComponent(options.appKey)},\n\t        success: suc || _utils.emptyfn,\n\t        error: error || _utils.emptyfn\n\t    };\n\t    _utils.ajax(options2);\n\t};\n\n\tconnection.prototype.signup = function (options) {\n\t    var self = this;\n\t    var orgName = options.orgName || '';\n\t    var appName = options.appName || '';\n\t    var appKey = options.appKey || '';\n\t    var suc = options.success || EMPTYFN;\n\t    var err = options.error || EMPTYFN;\n\n\t    if (!orgName && !appName && appKey) {\n\t        var devInfos = appKey.split('#');\n\t        if (devInfos.length === 2) {\n\t            orgName = devInfos[0];\n\t            appName = devInfos[1];\n\t        }\n\t    }\n\t    if (!orgName && !appName) {\n\t        err({\n\t            type: _code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR\n\t        });\n\t        return;\n\t    }\n\n\t    var error = function (res, xhr, msg) {\n\t        if (location.protocol != 'https:' && WebIM.config.isHttpDNS) {\n\t            if ((self.restIndex + 1) < self.restTotal) {\n\t                self.restIndex++;\n\t                self.getRestFromHttpDNS(options, 'signup');\n\t                return;\n\t            }\n\t        }\n\t        self.clear();\n\t        err(res);\n\t    };\n\t    var https = options.https || https;\n\t    var apiUrl = options.apiUrl;\n\t    var restUrl = apiUrl + '/' + orgName + '/' + appName + '/users';\n\n\t    var userjson = {\n\t        username: options.username,\n\t        password: options.password,\n\t        nickname: options.nickname || ''\n\t    };\n\n\t    var userinfo = _utils.stringify(userjson);\n\t    var options2 = {\n\t        url: restUrl,\n\t        dataType: 'json',\n\t        data: userinfo,\n\t        success: suc,\n\t        error: error\n\t    };\n\t    _utils.ajax(options2);\n\t};\n\n\n\tconnection.prototype.open = function (options) {\n\t    if (location.protocol != 'https:' && WebIM.config.isHttpDNS) {\n\t        this.dnsIndex = 0;\n\t        this.getHttpDNS(options, 'login');\n\t    } else {\n\t        this.login(options);\n\t    }\n\t};\n\n\tconnection.prototype.login = function (options) {\n\t    var pass = _validCheck(options, this);\n\n\t    if (!pass) {\n\t        return;\n\t    }\n\n\t    var conn = this;\n\n\t    if (conn.isOpened()) {\n\t        return;\n\t    }\n\n\t    if (options.accessToken) {\n\t        options.access_token = options.accessToken;\n\t        _login(options, conn);\n\t    } else {\n\t        var apiUrl = options.apiUrl;\n\t        var userId = this.context.userId;\n\t        var pwd = options.pwd || '';\n\t        var appName = this.context.appName;\n\t        var orgName = this.context.orgName;\n\n\t        var suc = function (data, xhr) {\n\t            conn.context.status = _code.STATUS_DOLOGIN_IM;\n\t            conn.context.restTokenData = data;\n\t            _login(data, conn);\n\t        };\n\t        var error = function (res, xhr, msg) {\n\t            if (location.protocol != 'https:' && WebIM.config.isHttpDNS) {\n\t                if ((conn.restIndex + 1) < conn.restTotal) {\n\t                    conn.restIndex++;\n\t                    conn.getRestFromHttpDNS(options, 'login');\n\t                    return;\n\t                }\n\t            }\n\t            conn.clear();\n\t            if (res.error && res.error_description) {\n\t                conn.onError({\n\t                    type: _code.WEBIM_CONNCTION_OPEN_USERGRID_ERROR,\n\t                    data: res,\n\t                    xhr: xhr\n\t                });\n\t            } else {\n\t                conn.onError({\n\t                    type: _code.WEBIM_CONNCTION_OPEN_ERROR,\n\t                    data: res,\n\t                    xhr: xhr\n\t                });\n\t            }\n\t        };\n\n\t        this.context.status = _code.STATUS_DOLOGIN_USERGRID;\n\n\t        var loginJson = {\n\t            grant_type: 'password',\n\t            username: userId,\n\t            password: pwd,\n\t            timestamp: +new Date()\n\t        };\n\t        var loginfo = _utils.stringify(loginJson);\n\n\t        var options2 = {\n\t            url: apiUrl + '/' + orgName + '/' + appName + '/token',\n\t            dataType: 'json',\n\t            data: loginfo,\n\t            success: suc || _utils.emptyfn,\n\t            error: error || _utils.emptyfn\n\t        };\n\t        _utils.ajax(options2);\n\t    }\n\t};\n\n\t// attach to xmpp server for BOSH\n\tconnection.prototype.attach = function (options) {\n\t    var pass = _validCheck(options, this);\n\n\t    if (!pass) {\n\t        return;\n\t    }\n\n\t    options = options || {};\n\n\t    var accessToken = options.accessToken || '';\n\t    if (accessToken == '') {\n\t        this.onError({\n\t            type: _code.WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR\n\t        });\n\t        return;\n\t    }\n\n\t    var sid = options.sid || '';\n\t    if (sid === '') {\n\t        this.onError({\n\t            type: _code.WEBIM_CONNCTION_SESSIONID_NOT_ASSIGN_ERROR\n\t        });\n\t        return;\n\t    }\n\n\t    var rid = options.rid || '';\n\t    if (rid === '') {\n\t        this.onError({\n\t            type: _code.WEBIM_CONNCTION_RID_NOT_ASSIGN_ERROR\n\t        });\n\t        return;\n\t    }\n\n\t    var stropheConn = this.getStrophe();\n\n\t    this.context.accessToken = accessToken;\n\t    this.context.stropheConn = stropheConn;\n\t    this.context.status = _code.STATUS_DOLOGIN_IM;\n\n\t    var conn = this;\n\t    var callback = function (status, msg) {\n\t        _loginCallback(status, msg, conn);\n\t    };\n\n\t    var jid = this.context.jid;\n\t    var wait = this.wait;\n\t    var hold = this.hold;\n\t    var wind = this.wind || 5;\n\t    stropheConn.attach(jid, sid, rid, callback, wait, hold, wind);\n\t};\n\n\tconnection.prototype.close = function (reason) {\n\t    this.stopHeartBeat();\n\n\t    var status = this.context.status;\n\t    if (status == _code.STATUS_INIT) {\n\t        return;\n\t    }\n\n\t    if (this.isClosed() || this.isClosing()) {\n\t        return;\n\t    }\n\n\t    this.context.status = _code.STATUS_CLOSING;\n\t    this.context.stropheConn.disconnect(reason);\n\t};\n\n\tconnection.prototype.addHandler = function (handler, ns, name, type, id, from, options) {\n\t    this.context.stropheConn.addHandler(handler, ns, name, type, id, from, options);\n\t};\n\n\tconnection.prototype.notifyVersion = function (suc, fail) {\n\t    var jid = _getJid({}, this);\n\t    var dom = $iq({\n\t        from: this.context.jid || ''\n\t        , to: this.domain\n\t        , type: 'result'\n\t    })\n\t        .c('query', {xmlns: 'jabber:iq:version'})\n\t        .c('name')\n\t        .t('easemob')\n\t        .up()\n\t        .c('version')\n\t        .t(_version)\n\t        .up()\n\t        .c('os')\n\t        .t('webim');\n\n\t    var suc = suc || _utils.emptyfn;\n\t    var error = fail || this.onError;\n\t    var failFn = function (ele) {\n\t        error({\n\t            type: _code.WEBIM_CONNCTION_NOTIFYVERSION_ERROR\n\t            , data: ele\n\t        });\n\t    };\n\t    this.context.stropheConn.sendIQ(dom.tree(), suc, failFn);\n\t    return;\n\t};\n\n\t// handle all types of presence message\n\tconnection.prototype.handlePresence = function (msginfo) {\n\t    if (this.isClosed()) {\n\t        return;\n\t    }\n\t    var from = msginfo.getAttribute('from') || '';\n\t    var to = msginfo.getAttribute('to') || '';\n\t    var type = msginfo.getAttribute('type') || '';\n\t    var presence_type = msginfo.getAttribute('presence_type') || '';\n\t    var fromUser = _parseNameFromJidFn(from);\n\t    var toUser = _parseNameFromJidFn(to);\n\t    var info = {\n\t        from: fromUser,\n\t        to: toUser,\n\t        fromJid: from,\n\t        toJid: to,\n\t        type: type,\n\t        chatroom: msginfo.getElementsByTagName('roomtype').length ? true : false\n\t    };\n\n\t    var showTags = msginfo.getElementsByTagName('show');\n\t    if (showTags && showTags.length > 0) {\n\t        var showTag = showTags[0];\n\t        info.show = Strophe.getText(showTag);\n\t    }\n\t    var statusTags = msginfo.getElementsByTagName('status');\n\t    if (statusTags && statusTags.length > 0) {\n\t        var statusTag = statusTags[0];\n\t        info.status = Strophe.getText(statusTag);\n\t        info.code = statusTag.getAttribute('code');\n\t    }\n\n\t    var priorityTags = msginfo.getElementsByTagName('priority');\n\t    if (priorityTags && priorityTags.length > 0) {\n\t        var priorityTag = priorityTags[0];\n\t        info.priority = Strophe.getText(priorityTag);\n\t    }\n\n\t    var error = msginfo.getElementsByTagName('error');\n\t    if (error && error.length > 0) {\n\t        var error = error[0];\n\t        info.error = {\n\t            code: error.getAttribute('code')\n\t        };\n\t    }\n\n\t    var destroy = msginfo.getElementsByTagName('destroy');\n\t    if (destroy && destroy.length > 0) {\n\t        var destroy = destroy[0];\n\t        info.destroy = true;\n\n\t        var reason = destroy.getElementsByTagName('reason');\n\t        if (reason && reason.length > 0) {\n\t            info.reason = Strophe.getText(reason[0]);\n\t        }\n\t    }\n\n\t    // <item affiliation=\"member\" jid=\"easemob-demo#chatdemoui_lwz2@easemob.com\" role=\"none\">\n\t    //     <actor nick=\"liuwz\"/>\n\t    // </item>\n\t    // one record once a time\n\t    // kick info: actor / member\n\t    var members = msginfo.getElementsByTagName('item');\n\t    if (members && members.length > 0) {\n\t        var member = members[0];\n\t        var role = member.getAttribute('role');\n\t        var jid = member.getAttribute('jid');\n\t        // dismissed by group\n\t        if (role == 'none' && jid) {\n\t            var kickedMember = _parseNameFromJidFn(jid);\n\t            var actor = member.getElementsByTagName('actor')[0];\n\t            var actorNick = actor.getAttribute('nick');\n\t            info.actor = actorNick;\n\t            info.kicked = kickedMember;\n\t        }\n\t        // Service Acknowledges Room Creation `createGroupACK`\n\t        if (role == 'moderator' && info.code == '201') {\n\t            // info.type = 'createGroupACK';\n\t            info.type = 'joinPublicGroupSuccess';\n\t        }\n\t    }\n\n\t    // from message : apply to join group\n\t    // <message from=\"easemob-demo#chatdemoui_lwz4@easemob.com/mobile\" id=\"259151681747419640\" to=\"easemob-demo#chatdemoui_liuwz@easemob.com\" xmlns=\"jabber:client\">\n\t    //     <x xmlns=\"http://jabber.org/protocol/muc#user\">\n\t    //         <apply from=\"easemob-demo#chatdemoui_lwz4@easemob.com\" to=\"easemob-demo#chatdemoui_1477733677560@conference.easemob.com\" toNick=\"lwzlwzlwz\">\n\t    //             <reason>qwe</reason>\n\t    //         </apply>\n\t    //     </x>\n\t    // </message>\n\t    var apply = msginfo.getElementsByTagName('apply');\n\t    if (apply && apply.length > 0) {\n\t        apply = apply[0];\n\t        var toNick = apply.getAttribute('toNick');\n\t        var groupJid = apply.getAttribute('to');\n\t        var userJid = apply.getAttribute('from');\n\t        var groupName = _parseNameFromJidFn(groupJid);\n\t        var userName = _parseNameFromJidFn(userJid);\n\t        info.toNick = toNick;\n\t        info.groupName = groupName;\n\t        info.type = 'joinGroupNotifications';\n\t        var reason = apply.getElementsByTagName('reason');\n\t        if (reason && reason.length > 0) {\n\t            info.reason = Strophe.getText(reason[0]);\n\t        }\n\t    }\n\n\n\t    if (info.chatroom) {\n\t        // diff the\n\t        info.presence_type = presence_type;\n\t        info.original_type = info.type;\n\t        var reflectUser = from.slice(from.lastIndexOf('/') + 1);\n\n\t        if (reflectUser === this.context.userId) {\n\t            if (info.type === '' && !info.code) {\n\t                info.type = 'joinChatRoomSuccess';\n\t            } else if (presence_type === 'unavailable' || info.type === 'unavailable') {\n\t                if (!info.status) {// logout successfully.\n\t                    info.type = 'leaveChatRoom';\n\t                } else if (info.code == 110) {// logout or dismissied by admin.\n\t                    info.type = 'leaveChatRoom';\n\t                } else if (info.error && info.error.code == 406) {// The chat room is full.\n\t                    info.type = 'reachChatRoomCapacity';\n\t                }\n\t            }\n\t        }\n\t    } else {\n\t        info.presence_type = presence_type;\n\t        info.original_type = type;\n\n\t        if (/subscribe/.test(info.type)) {\n\t            //subscribe | subscribed | unsubscribe | unsubscribed\n\t        } else if (type == \"\" && !info.status && !info.error) {\n\t            info.type = 'joinPublicGroupSuccess';\n\t        } else if (presence_type === 'unavailable' || type === 'unavailable') {// There is no roomtype when a chat room is deleted.\n\t            if (info.destroy) {// Group or Chat room Deleted.\n\t                info.type = 'deleteGroupChat';\n\t            } else if (info.code == 307 || info.code == 321) {// Dismissed by group.\n\t                info.type = 'leaveGroup';\n\t            }\n\t        }\n\t    }\n\t    this.onPresence(info, msginfo);\n\t};\n\n\tconnection.prototype.handlePing = function (e) {\n\t    if (this.isClosed()) {\n\t        return;\n\t    }\n\t    var id = e.getAttribute('id');\n\t    var from = e.getAttribute('from');\n\t    var to = e.getAttribute('to');\n\t    var dom = $iq({\n\t        from: to\n\t        , to: from\n\t        , id: id\n\t        , type: 'result'\n\t    });\n\t    this.sendCommand(dom.tree());\n\t};\n\n\tconnection.prototype.handleIq = function (iq) {\n\t    return true;\n\t};\n\n\tconnection.prototype.handleIqPrivacy = function (msginfo) {\n\t    var list = msginfo.getElementsByTagName('list');\n\t    if (list.length == 0) {\n\t        return;\n\t    }\n\t    this.getBlacklist();\n\t};\n\n\tconnection.prototype.handleIqRoster = function (e) {\n\t    var id = e.getAttribute('id');\n\t    var from = e.getAttribute('from') || '';\n\t    var name = _parseNameFromJidFn(from);\n\t    var curJid = this.context.jid;\n\t    var curUser = this.context.userId;\n\n\t    var iqresult = $iq({type: 'result', id: id, from: curJid});\n\t    this.sendCommand(iqresult.tree());\n\n\t    var msgBodies = e.getElementsByTagName('query');\n\t    if (msgBodies && msgBodies.length > 0) {\n\t        var queryTag = msgBodies[0];\n\t        var rouster = _parseFriend(queryTag, this, from);\n\t        this.onRoster(rouster);\n\t    }\n\t    return true;\n\t};\n\n\tconnection.prototype.handleMessage = function (msginfo) {\n\t    if (this.isClosed()) {\n\t        return;\n\t    }\n\n\t    var id = msginfo.getAttribute('id') || '';\n\n\t    // cache ack into sendQueue first , handelSendQueue will do the send thing with the speed of  5/s\n\t    this.cacheReceiptsMessage({\n\t        id: id\n\t    });\n\t    var parseMsgData = _parseResponseMessage(msginfo);\n\t    if (parseMsgData.errorMsg) {\n\t        this.handlePresence(msginfo);\n\t        return;\n\t    }\n\t    // send error\n\t    var error = msginfo.getElementsByTagName('error');\n\t    var errorCode = '';\n\t    var errorText = '';\n\t    var errorBool = false;\n\t    if (error.length > 0) {\n\t        errorBool = true;\n\t        errorCode = error[0].getAttribute('code');\n\t        var textDOM = error[0].getElementsByTagName('text');\n\t        errorText = textDOM[0].textContent || textDOM[0].text;\n\t        log('handle error', errorCode, errorText);\n\t    }\n\n\t    var msgDatas = parseMsgData.data;\n\t    for (var i in msgDatas) {\n\t        if (!msgDatas.hasOwnProperty(i)) {\n\t            continue;\n\t        }\n\t        var msg = msgDatas[i];\n\t        if (!msg.from || !msg.to) {\n\t            continue;\n\t        }\n\n\t        var from = (msg.from + '').toLowerCase();\n\t        var too = (msg.to + '').toLowerCase();\n\t        var extmsg = msg.ext || {};\n\t        var chattype = '';\n\t        var typeEl = msginfo.getElementsByTagName('roomtype');\n\t        if (typeEl.length) {\n\t            chattype = typeEl[0].getAttribute('type') || 'chat';\n\t        } else {\n\t            chattype = msginfo.getAttribute('type') || 'chat';\n\t        }\n\n\t        var msgBodies = msg.bodies;\n\t        if (!msgBodies || msgBodies.length == 0) {\n\t            continue;\n\t        }\n\t        var msgBody = msg.bodies[0];\n\t        var type = msgBody.type;\n\n\t        try {\n\t            switch (type) {\n\t                case 'txt':\n\t                    var receiveMsg = msgBody.msg;\n\t                    var emojibody = _utils.parseTextMessage(receiveMsg, WebIM.Emoji);\n\t                    if (emojibody.isemoji) {\n\t                        var msg = {\n\t                            id: id\n\t                            , type: chattype\n\t                            , from: from\n\t                            , to: too\n\t                            , delay: parseMsgData.delayTimeStamp\n\t                            , data: emojibody.body\n\t                            , ext: extmsg\n\t                        };\n\t                        !msg.delay && delete msg.delay;\n\t                        msg.error = errorBool;\n\t                        msg.errorText = errorText;\n\t                        msg.errorCode = errorCode;\n\t                        this.onEmojiMessage(msg);\n\t                    } else {\n\t                        var msg = {\n\t                            id: id\n\t                            , type: chattype\n\t                            , from: from\n\t                            , to: too\n\t                            , delay: parseMsgData.delayTimeStamp\n\t                            , data: receiveMsg\n\t                            , ext: extmsg\n\t                        };\n\t                        !msg.delay && delete msg.delay;\n\t                        msg.error = errorBool;\n\t                        msg.errorText = errorText;\n\t                        msg.errorCode = errorCode;\n\t                        this.onTextMessage(msg);\n\t                    }\n\t                    break;\n\t                case 'img':\n\t                    var rwidth = 0;\n\t                    var rheight = 0;\n\t                    if (msgBody.size) {\n\t                        rwidth = msgBody.size.width;\n\t                        rheight = msgBody.size.height;\n\t                    }\n\t                    var msg = {\n\t                        id: id\n\t                        , type: chattype\n\t                        , from: from\n\t                        , to: too\n\t                        ,\n\t                        url: (location.protocol != 'https:' && WebIM.config.isHttpDNS) ? (WebIM.config.apiURL + msgBody.url.substr(msgBody.url.indexOf(\"/\", 9))) : msgBody.url\n\t                        , secret: msgBody.secret\n\t                        , filename: msgBody.filename\n\t                        , thumb: msgBody.thumb\n\t                        , thumb_secret: msgBody.thumb_secret\n\t                        , file_length: msgBody.file_length || ''\n\t                        , width: rwidth\n\t                        , height: rheight\n\t                        , filetype: msgBody.filetype || ''\n\t                        , accessToken: this.context.accessToken || ''\n\t                        , ext: extmsg\n\t                        , delay: parseMsgData.delayTimeStamp\n\t                    };\n\t                    !msg.delay && delete msg.delay;\n\t                    msg.error = errorBool;\n\t                    msg.errorText = errorText;\n\t                    msg.errorCode = errorCode;\n\t                    this.onPictureMessage(msg);\n\t                    break;\n\t                case 'audio':\n\t                    var msg = {\n\t                        id: id\n\t                        , type: chattype\n\t                        , from: from\n\t                        , to: too\n\t                        ,\n\t                        url: (location.protocol != 'https:' && WebIM.config.isHttpDNS) ? (WebIM.config.apiURL + msgBody.url.substr(msgBody.url.indexOf(\"/\", 9))) : msgBody.url\n\t                        , secret: msgBody.secret\n\t                        , filename: msgBody.filename\n\t                        , length: msgBody.length || ''\n\t                        , file_length: msgBody.file_length || ''\n\t                        , filetype: msgBody.filetype || ''\n\t                        , accessToken: this.context.accessToken || ''\n\t                        , ext: extmsg\n\t                        , delay: parseMsgData.delayTimeStamp\n\t                    };\n\t                    !msg.delay && delete msg.delay;\n\t                    msg.error = errorBool;\n\t                    msg.errorText = errorText;\n\t                    msg.errorCode = errorCode;\n\t                    this.onAudioMessage(msg);\n\t                    break;\n\t                case 'file':\n\t                    var msg = {\n\t                        id: id\n\t                        , type: chattype\n\t                        , from: from\n\t                        , to: too\n\t                        ,\n\t                        url: (location.protocol != 'https:' && WebIM.config.isHttpDNS) ? (WebIM.config.apiURL + msgBody.url.substr(msgBody.url.indexOf(\"/\", 9))) : msgBody.url\n\t                        , secret: msgBody.secret\n\t                        , filename: msgBody.filename\n\t                        , file_length: msgBody.file_length\n\t                        , accessToken: this.context.accessToken || ''\n\t                        , ext: extmsg\n\t                        , delay: parseMsgData.delayTimeStamp\n\t                    };\n\t                    !msg.delay && delete msg.delay;\n\t                    msg.error = errorBool;\n\t                    msg.errorText = errorText;\n\t                    msg.errorCode = errorCode;\n\t                    this.onFileMessage(msg);\n\t                    break;\n\t                case 'loc':\n\t                    var msg = {\n\t                        id: id\n\t                        , type: chattype\n\t                        , from: from\n\t                        , to: too\n\t                        , addr: msgBody.addr\n\t                        , lat: msgBody.lat\n\t                        , lng: msgBody.lng\n\t                        , ext: extmsg\n\t                        , delay: parseMsgData.delayTimeStamp\n\t                    };\n\t                    !msg.delay && delete msg.delay;\n\t                    msg.error = errorBool;\n\t                    msg.errorText = errorText;\n\t                    msg.errorCode = errorCode;\n\t                    this.onLocationMessage(msg);\n\t                    break;\n\t                case 'video':\n\t                    var msg = {\n\t                        id: id\n\t                        , type: chattype\n\t                        , from: from\n\t                        , to: too\n\t                        ,\n\t                        url: (location.protocol != 'https:' && WebIM.config.isHttpDNS) ? (WebIM.config.apiURL + msgBody.url.substr(msgBody.url.indexOf(\"/\", 9))) : msgBody.url\n\t                        , secret: msgBody.secret\n\t                        , filename: msgBody.filename\n\t                        , file_length: msgBody.file_length\n\t                        , accessToken: this.context.accessToken || ''\n\t                        , ext: extmsg\n\t                        , delay: parseMsgData.delayTimeStamp\n\t                    };\n\t                    !msg.delay && delete msg.delay;\n\t                    msg.error = errorBool;\n\t                    msg.errorText = errorText;\n\t                    msg.errorCode = errorCode;\n\t                    this.onVideoMessage(msg);\n\t                    break;\n\t                case 'cmd':\n\t                    var msg = {\n\t                        id: id\n\t                        , from: from\n\t                        , to: too\n\t                        , action: msgBody.action\n\t                        , ext: extmsg\n\t                        , delay: parseMsgData.delayTimeStamp\n\t                    };\n\t                    !msg.delay && delete msg.delay;\n\t                    msg.error = errorBool;\n\t                    msg.errorText = errorText;\n\t                    msg.errorCode = errorCode;\n\t                    this.onCmdMessage(msg);\n\t                    break;\n\t            }\n\t            ;\n\t        } catch (e) {\n\t            this.onError({\n\t                type: _code.WEBIM_CONNCTION_CALLBACK_INNER_ERROR\n\t                , data: e\n\t            });\n\t        }\n\t    }\n\t};\n\n\tconnection.prototype.handleReceivedMessage = function (message) {\n\t    try {\n\t        this.onReceivedMessage(message);\n\t    } catch (e) {\n\t        this.onError({\n\t            type: _code.WEBIM_CONNCTION_CALLBACK_INNER_ERROR\n\t            , data: e\n\t        });\n\t    }\n\n\t    var rcv = message.getElementsByTagName('received'),\n\t        id,\n\t        mid;\n\n\t    if (rcv.length > 0) {\n\t        if (rcv[0].childNodes && rcv[0].childNodes.length > 0) {\n\t            id = rcv[0].childNodes[0].nodeValue;\n\t        } else {\n\t            id = rcv[0].innerHTML || rcv[0].innerText;\n\t        }\n\t        mid = rcv[0].getAttribute('mid');\n\t    }\n\n\t    if (_msgHash[id]) {\n\t        try {\n\t            _msgHash[id].msg.success instanceof Function && _msgHash[id].msg.success(id, mid);\n\t        } catch (e) {\n\t            this.onError({\n\t                type: _code.WEBIM_CONNCTION_CALLBACK_INNER_ERROR\n\t                , data: e\n\t            });\n\t        }\n\t        delete _msgHash[id];\n\t    }\n\t};\n\n\tconnection.prototype.handleInviteMessage = function (message) {\n\t    var form = null;\n\t    var invitemsg = message.getElementsByTagName('invite');\n\t    var reasonDom = message.getElementsByTagName('reason')[0];\n\t    var reasonMsg = reasonDom.textContent;\n\t    var id = message.getAttribute('id') || '';\n\t    this.sendReceiptsMessage({\n\t        id: id\n\t    });\n\n\t    if (invitemsg && invitemsg.length > 0) {\n\t        var fromJid = invitemsg[0].getAttribute('from');\n\t        form = _parseNameFromJidFn(fromJid);\n\t    }\n\t    var xmsg = message.getElementsByTagName('x');\n\t    var roomid = null;\n\t    if (xmsg && xmsg.length > 0) {\n\t        for (var i = 0; i < xmsg.length; i++) {\n\t            if ('jabber:x:conference' === xmsg[i].namespaceURI) {\n\t                var roomjid = xmsg[i].getAttribute('jid');\n\t                roomid = _parseNameFromJidFn(roomjid);\n\t            }\n\t        }\n\t    }\n\t    this.onInviteMessage({\n\t        type: 'invite',\n\t        from: form,\n\t        roomid: roomid,\n\t        reason: reasonMsg\n\t    });\n\t};\n\n\tconnection.prototype.sendCommand = function (dom, id) {\n\t    if (this.isOpened()) {\n\t        this.context.stropheConn.send(dom);\n\t    } else {\n\t        this.onError({\n\t            type: _code.WEBIM_CONNCTION_DISCONNECTED,\n\t            reconnect: true\n\t        });\n\t    }\n\t};\n\n\tconnection.prototype.getUniqueId = function (prefix) {\n\t    var cdate = new Date();\n\t    var offdate = new Date(2010, 1, 1);\n\t    var offset = cdate.getTime() - offdate.getTime();\n\t    var hexd = parseInt(offset).toString(16);\n\n\t    if (typeof prefix === 'string' || typeof prefix === 'number') {\n\t        return prefix + '_' + hexd;\n\t    } else {\n\t        return 'WEBIM_' + hexd;\n\t    }\n\t};\n\n\tconnection.prototype.send = function (message) {\n\t    if (WebIM.config.isWindowSDK) {\n\t        WebIM.doQuery('{\"type\":\"sendMessage\",\"to\":\"' + message.to + '\",\"message_type\":\"' + message.type + '\",\"msg\":\"' + encodeURI(message.msg) + '\",\"chatType\":\"' + message.chatType + '\"}',\n\t            function (response) {\n\t            },\n\t            function (code, msg) {\n\t                Demo.api.NotifyError('send:' + code + \" - \" + msg);\n\t            });\n\t    } else {\n\t        if (Object.prototype.toString.call(message) === '[object Object]') {\n\t            var appKey = this.context.appKey || '';\n\t            var toJid = appKey + '_' + message.to + '@' + this.domain;\n\n\t            if (message.group) {\n\t                toJid = appKey + '_' + message.to + '@conference.' + this.domain;\n\t            }\n\t            if (message.resource) {\n\t                toJid = toJid + '/' + message.resource;\n\t            }\n\n\t            message.toJid = toJid;\n\t            message.id = message.id || this.getUniqueId();\n\t            _msgHash[message.id] = new _message(message);\n\t            _msgHash[message.id].send(this);\n\t        } else if (typeof message === 'string') {\n\t            _msgHash[message] && _msgHash[message].send(this);\n\t        }\n\t    }\n\t};\n\n\tconnection.prototype.addRoster = function (options) {\n\t    var jid = _getJid(options, this);\n\t    var name = options.name || '';\n\t    var groups = options.groups || '';\n\n\t    var iq = $iq({type: 'set'});\n\t    iq.c('query', {xmlns: 'jabber:iq:roster'});\n\t    iq.c('item', {jid: jid, name: name});\n\n\t    if (groups) {\n\t        for (var i = 0; i < groups.length; i++) {\n\t            iq.c('group').t(groups[i]).up();\n\t        }\n\t    }\n\t    var suc = options.success || _utils.emptyfn;\n\t    var error = options.error || _utils.emptyfn;\n\t    this.context.stropheConn.sendIQ(iq.tree(), suc, error);\n\t};\n\n\tconnection.prototype.removeRoster = function (options) {\n\t    var jid = _getJid(options, this);\n\t    var iq = $iq({type: 'set'}).c('query', {xmlns: 'jabber:iq:roster'}).c('item', {\n\t        jid: jid,\n\t        subscription: 'remove'\n\t    });\n\n\t    var suc = options.success || _utils.emptyfn;\n\t    var error = options.error || _utils.emptyfn;\n\t    this.context.stropheConn.sendIQ(iq, suc, error);\n\t};\n\n\tconnection.prototype.getRoster = function (options) {\n\t    var conn = this;\n\t    var dom = $iq({\n\t        type: 'get'\n\t    }).c('query', {xmlns: 'jabber:iq:roster'});\n\n\t    var options = options || {};\n\t    var suc = options.success || this.onRoster;\n\t    var completeFn = function (ele) {\n\t        var rouster = [];\n\t        var msgBodies = ele.getElementsByTagName('query');\n\t        if (msgBodies && msgBodies.length > 0) {\n\t            var queryTag = msgBodies[0];\n\t            rouster = _parseFriend(queryTag);\n\t        }\n\t        suc(rouster, ele);\n\t    };\n\t    var error = options.error || this.onError;\n\t    var failFn = function (ele) {\n\t        error({\n\t            type: _code.WEBIM_CONNCTION_GETROSTER_ERROR\n\t            , data: ele\n\t        });\n\t    };\n\t    if (this.isOpened()) {\n\t        this.context.stropheConn.sendIQ(dom.tree(), completeFn, failFn);\n\t    } else {\n\t        error({\n\t            type: _code.WEBIM_CONNCTION_DISCONNECTED\n\t        });\n\t    }\n\t};\n\n\tconnection.prototype.subscribe = function (options) {\n\t    var jid = _getJid(options, this);\n\t    var pres = $pres({to: jid, type: 'subscribe'});\n\t    if (options.message) {\n\t        pres.c('status').t(options.message).up();\n\t    }\n\t    if (options.nick) {\n\t        pres.c('nick', {'xmlns': 'http://jabber.org/protocol/nick'}).t(options.nick);\n\t    }\n\t    this.sendCommand(pres.tree());\n\t};\n\n\tconnection.prototype.subscribed = function (options) {\n\t    var jid = _getJid(options, this);\n\t    var pres = $pres({to: jid, type: 'subscribed'});\n\n\t    if (options.message) {\n\t        pres.c('status').t(options.message).up();\n\t    }\n\t    this.sendCommand(pres.tree());\n\t};\n\n\tconnection.prototype.unsubscribe = function (options) {\n\t    var jid = _getJid(options, this);\n\t    var pres = $pres({to: jid, type: 'unsubscribe'});\n\n\t    if (options.message) {\n\t        pres.c('status').t(options.message);\n\t    }\n\t    this.sendCommand(pres.tree());\n\t};\n\n\tconnection.prototype.unsubscribed = function (options) {\n\t    var jid = _getJid(options, this);\n\t    var pres = $pres({to: jid, type: 'unsubscribed'});\n\n\t    if (options.message) {\n\t        pres.c('status').t(options.message).up();\n\t    }\n\t    this.sendCommand(pres.tree());\n\t};\n\n\tconnection.prototype.createRoom = function (options) {\n\t    var suc = options.success || _utils.emptyfn;\n\t    var err = options.error || _utils.emptyfn;\n\t    var roomiq;\n\n\t    roomiq = $iq({\n\t        to: options.roomName,\n\t        type: 'set'\n\t    })\n\t        .c('query', {xmlns: Strophe.NS.MUC_OWNER})\n\t        .c('x', {xmlns: 'jabber:x:data', type: 'submit'});\n\n\t    return this.context.stropheConn.sendIQ(roomiq.tree(), suc, err);\n\t};\n\n\tconnection.prototype.joinPublicGroup = function (options) {\n\t    var roomJid = this.context.appKey + '_' + options.roomId + '@conference.' + this.domain;\n\t    var room_nick = roomJid + '/' + this.context.userId;\n\t    var suc = options.success || _utils.emptyfn;\n\t    var err = options.error || _utils.emptyfn;\n\t    var errorFn = function (ele) {\n\t        err({\n\t            type: _code.WEBIM_CONNCTION_JOINROOM_ERROR,\n\t            data: ele\n\t        });\n\t    };\n\t    var iq = $pres({\n\t        from: this.context.jid,\n\t        to: room_nick\n\t    })\n\t        .c('x', {xmlns: Strophe.NS.MUC});\n\n\t    this.context.stropheConn.sendIQ(iq.tree(), suc, errorFn);\n\t};\n\n\tconnection.prototype.listRooms = function (options) {\n\t    var iq = $iq({\n\t        to: options.server || 'conference.' + this.domain,\n\t        from: this.context.jid,\n\t        type: 'get'\n\t    })\n\t        .c('query', {xmlns: Strophe.NS.DISCO_ITEMS});\n\n\t    var suc = options.success || _utils.emptyfn;\n\t    var error = options.error || this.onError;\n\t    var completeFn = function (result) {\n\t        var rooms = [];\n\t        rooms = _parseRoom(result);\n\t        try {\n\t            suc(rooms);\n\t        } catch (e) {\n\t            error({\n\t                type: _code.WEBIM_CONNCTION_GETROOM_ERROR,\n\t                data: e\n\t            });\n\t        }\n\t    };\n\t    var err = options.error || _utils.emptyfn;\n\t    var errorFn = function (ele) {\n\t        err({\n\t            type: _code.WEBIM_CONNCTION_GETROOM_ERROR\n\t            , data: ele\n\t        });\n\t    };\n\t    this.context.stropheConn.sendIQ(iq.tree(), completeFn, errorFn);\n\t};\n\n\tconnection.prototype.queryRoomMember = function (options) {\n\t    var domain = this.domain;\n\t    var members = [];\n\t    var iq = $iq({\n\t        to: this.context.appKey + '_' + options.roomId + '@conference.' + this.domain\n\t        , type: 'get'\n\t    })\n\t        .c('query', {xmlns: Strophe.NS.MUC + '#admin'})\n\t        .c('item', {affiliation: 'member'});\n\n\t    var suc = options.success || _utils.emptyfn;\n\t    var completeFn = function (result) {\n\t        var items = result.getElementsByTagName('item');\n\n\t        if (items) {\n\t            for (var i = 0; i < items.length; i++) {\n\t                var item = items[i];\n\t                var mem = {\n\t                    jid: item.getAttribute('jid')\n\t                    , affiliation: 'member'\n\t                };\n\t                members.push(mem);\n\t            }\n\t        }\n\t        suc(members);\n\t    };\n\t    var err = options.error || _utils.emptyfn;\n\t    var errorFn = function (ele) {\n\t        err({\n\t            type: _code.WEBIM_CONNCTION_GETROOMMEMBER_ERROR\n\t            , data: ele\n\t        });\n\t    };\n\t    this.context.stropheConn.sendIQ(iq.tree(), completeFn, errorFn);\n\t};\n\n\tconnection.prototype.queryRoomInfo = function (options) {\n\t    var domain = this.domain;\n\t    var iq = $iq({\n\t        to: this.context.appKey + '_' + options.roomId + '@conference.' + domain,\n\t        type: 'get'\n\t    }).c('query', {xmlns: Strophe.NS.DISCO_INFO});\n\n\t    var suc = options.success || _utils.emptyfn;\n\t    var members = [];\n\n\t    var completeFn = function (result) {\n\t        var settings = '';\n\t        var features = result.getElementsByTagName('feature');\n\t        if (features) {\n\t            settings = features[1].getAttribute('var') + '|' + features[3].getAttribute('var') + '|' + features[4].getAttribute('var');\n\t        }\n\t        switch (settings) {\n\t            case 'muc_public|muc_membersonly|muc_notallowinvites':\n\t                settings = 'PUBLIC_JOIN_APPROVAL';\n\t                break;\n\t            case 'muc_public|muc_open|muc_notallowinvites':\n\t                settings = 'PUBLIC_JOIN_OPEN';\n\t                break;\n\t            case 'muc_hidden|muc_membersonly|muc_allowinvites':\n\t                settings = 'PRIVATE_MEMBER_INVITE';\n\t                break;\n\t            case 'muc_hidden|muc_membersonly|muc_notallowinvites':\n\t                settings = 'PRIVATE_OWNER_INVITE';\n\t                break;\n\t        }\n\t        var owner = '';\n\t        var fields = result.getElementsByTagName('field');\n\t        var fieldValues = {};\n\t        if (fields) {\n\t            for (var i = 0; i < fields.length; i++) {\n\t                var field = fields[i];\n\t                var fieldVar = field.getAttribute('var');\n\t                var fieldSimplify = fieldVar.split('_')[1];\n\t                switch (fieldVar) {\n\t                    case 'muc#roominfo_occupants':\n\t                    case 'muc#roominfo_maxusers':\n\t                    case 'muc#roominfo_affiliations':\n\t                    case 'muc#roominfo_description':\n\t                        fieldValues[fieldSimplify] = (field.textContent || field.text || '');\n\t                        break;\n\t                    case 'muc#roominfo_owner':\n\t                        var mem = {\n\t                            jid: (field.textContent || field.text) + '@' + domain\n\t                            , affiliation: 'owner'\n\t                        };\n\t                        members.push(mem);\n\t                        fieldValues[fieldSimplify] = (field.textContent || field.text);\n\t                        break;\n\t                }\n\n\t                // if (field.getAttribute('label') === 'owner') {\n\t                //     var mem = {\n\t                //         jid: (field.textContent || field.text) + '@' + domain\n\t                //         , affiliation: 'owner'\n\t                //     };\n\t                //     members.push(mem);\n\t                //     break;\n\t                // }\n\t            }\n\t            fieldValues['name'] = (result.getElementsByTagName('identity')[0]).getAttribute('name');\n\t        }\n\t        log(settings, members, fieldValues);\n\t        suc(settings, members, fieldValues);\n\t    };\n\t    var err = options.error || _utils.emptyfn;\n\t    var errorFn = function (ele) {\n\t        err({\n\t            type: _code.WEBIM_CONNCTION_GETROOMINFO_ERROR\n\t            , data: ele\n\t        });\n\t    };\n\t    this.context.stropheConn.sendIQ(iq.tree(), completeFn, errorFn);\n\t};\n\n\tconnection.prototype.queryRoomOccupants = function (options) {\n\t    var suc = options.success || _utils.emptyfn;\n\t    var completeFn = function (result) {\n\t        var occupants = [];\n\t        occupants = _parseRoomOccupants(result);\n\t        suc(occupants);\n\t    }\n\t    var err = options.error || _utils.emptyfn;\n\t    var errorFn = function (ele) {\n\t        err({\n\t            type: _code.WEBIM_CONNCTION_GETROOMOCCUPANTS_ERROR\n\t            , data: ele\n\t        });\n\t    };\n\t    var attrs = {\n\t        xmlns: Strophe.NS.DISCO_ITEMS\n\t    };\n\t    var info = $iq({\n\t        from: this.context.jid\n\t        , to: this.context.appKey + '_' + options.roomId + '@conference.' + this.domain\n\t        , type: 'get'\n\t    }).c('query', attrs);\n\t    this.context.stropheConn.sendIQ(info.tree(), completeFn, errorFn);\n\t};\n\n\tconnection.prototype.setUserSig = function (desc) {\n\t    var dom = $pres({xmlns: 'jabber:client'});\n\t    desc = desc || '';\n\t    dom.c('status').t(desc);\n\t    this.sendCommand(dom.tree());\n\t};\n\n\tconnection.prototype.setPresence = function (type, status) {\n\t    var dom = $pres({xmlns: 'jabber:client'});\n\t    if (type) {\n\t        if (status) {\n\t            dom.c('show').t(type);\n\t            dom.up().c('status').t(status);\n\t        } else {\n\t            dom.c('show').t(type);\n\t        }\n\t    }\n\t    this.sendCommand(dom.tree());\n\t};\n\n\tconnection.prototype.getPresence = function () {\n\t    var dom = $pres({xmlns: 'jabber:client'});\n\t    var conn = this;\n\t    this.sendCommand(dom.tree());\n\t};\n\n\tconnection.prototype.ping = function (options) {\n\t    var options = options || {};\n\t    var jid = _getJid(options, this);\n\n\t    var dom = $iq({\n\t        from: this.context.jid || ''\n\t        , to: jid\n\t        , type: 'get'\n\t    }).c('ping', {xmlns: 'urn:xmpp:ping'});\n\n\t    var suc = options.success || _utils.emptyfn;\n\t    var error = options.error || this.onError;\n\t    var failFn = function (ele) {\n\t        error({\n\t            type: _code.WEBIM_CONNCTION_PING_ERROR\n\t            , data: ele\n\t        });\n\t    };\n\t    if (this.isOpened()) {\n\t        this.context.stropheConn.sendIQ(dom.tree(), suc, failFn);\n\t    } else {\n\t        error({\n\t            type: _code.WEBIM_CONNCTION_DISCONNECTED\n\t        });\n\t    }\n\t    return;\n\t};\n\n\tconnection.prototype.isOpened = function () {\n\t    return this.context.status == _code.STATUS_OPENED;\n\t};\n\n\tconnection.prototype.isOpening = function () {\n\t    var status = this.context.status;\n\t    return status == _code.STATUS_DOLOGIN_USERGRID || status == _code.STATUS_DOLOGIN_IM;\n\t};\n\n\tconnection.prototype.isClosing = function () {\n\t    return this.context.status == _code.STATUS_CLOSING;\n\t};\n\n\tconnection.prototype.isClosed = function () {\n\t    return this.context.status == _code.STATUS_CLOSED;\n\t};\n\n\tconnection.prototype.clear = function () {\n\t    var key = this.context.appKey;\n\t    if (this.errorType != WebIM.statusCode.WEBIM_CONNCTION_DISCONNECTED) {\n\t        this.context = {\n\t            status: _code.STATUS_INIT,\n\t            appKey: key\n\t        };\n\t    }\n\t    if (this.intervalId) {\n\t        clearInterval(this.intervalId);\n\t    }\n\t    this.restIndex = 0;\n\t    this.xmppIndex = 0;\n\n\t    if (this.errorType == WebIM.statusCode.WEBIM_CONNCTION_CLIENT_LOGOUT || this.errorType == -1) {\n\t        Demo.api.init();\n\t    }\n\t};\n\n\tconnection.prototype.getChatRooms = function (options) {\n\n\t    if (!_utils.isCanSetRequestHeader) {\n\t        conn.onError({\n\t            type: _code.WEBIM_CONNCTION_NOT_SUPPORT_CHATROOM_ERROR\n\t        });\n\t        return;\n\t    }\n\n\t    var conn = this,\n\t        token = options.accessToken || this.context.accessToken;\n\n\t    if (token) {\n\t        var apiUrl = options.apiUrl;\n\t        var appName = this.context.appName;\n\t        var orgName = this.context.orgName;\n\n\t        if (!appName || !orgName) {\n\t            conn.onError({\n\t                type: _code.WEBIM_CONNCTION_AUTH_ERROR\n\t            });\n\t            return;\n\t        }\n\n\t        var suc = function (data, xhr) {\n\t            typeof options.success === 'function' && options.success(data);\n\t        };\n\n\t        var error = function (res, xhr, msg) {\n\t            if (res.error && res.error_description) {\n\t                conn.onError({\n\t                    type: _code.WEBIM_CONNCTION_LOAD_CHATROOM_ERROR,\n\t                    msg: res.error_description,\n\t                    data: res,\n\t                    xhr: xhr\n\t                });\n\t            }\n\t        };\n\n\t        var pageInfo = {\n\t            pagenum: parseInt(options.pagenum) || 1,\n\t            pagesize: parseInt(options.pagesize) || 20\n\t        };\n\n\t        var opts = {\n\t            url: apiUrl + '/' + orgName + '/' + appName + '/chatrooms',\n\t            dataType: 'json',\n\t            type: 'GET',\n\t            headers: {'Authorization': 'Bearer ' + token},\n\t            data: pageInfo,\n\t            success: suc || _utils.emptyfn,\n\t            error: error || _utils.emptyfn\n\t        };\n\t        _utils.ajax(opts);\n\t    } else {\n\t        conn.onError({\n\t            type: _code.WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR\n\t        });\n\t    }\n\n\t};\n\n\tconnection.prototype.joinChatRoom = function (options) {\n\t    var roomJid = this.context.appKey + '_' + options.roomId + '@conference.' + this.domain;\n\t    var room_nick = roomJid + '/' + this.context.userId;\n\t    var suc = options.success || _utils.emptyfn;\n\t    var err = options.error || _utils.emptyfn;\n\t    var errorFn = function (ele) {\n\t        err({\n\t            type: _code.WEBIM_CONNCTION_JOINCHATROOM_ERROR\n\t            , data: ele\n\t        });\n\t    };\n\n\t    var iq = $pres({\n\t        from: this.context.jid,\n\t        to: room_nick\n\t    })\n\t        .c('x', {xmlns: Strophe.NS.MUC + '#user'})\n\t        .c('item', {affiliation: 'member', role: 'participant'})\n\t        .up().up()\n\t        .c('roomtype', {xmlns: 'easemob:x:roomtype', type: 'chatroom'});\n\n\t    this.context.stropheConn.sendIQ(iq.tree(), suc, errorFn);\n\t};\n\n\tconnection.prototype.quitChatRoom = function (options) {\n\t    var roomJid = this.context.appKey + '_' + options.roomId + '@conference.' + this.domain;\n\t    var room_nick = roomJid + '/' + this.context.userId;\n\t    var suc = options.success || _utils.emptyfn;\n\t    var err = options.error || _utils.emptyfn;\n\t    var errorFn = function (ele) {\n\t        err({\n\t            type: _code.WEBIM_CONNCTION_QUITCHATROOM_ERROR\n\t            , data: ele\n\t        });\n\t    };\n\t    var iq = $pres({\n\t        from: this.context.jid,\n\t        to: room_nick,\n\t        type: 'unavailable'\n\t    })\n\t        .c('x', {xmlns: Strophe.NS.MUC + '#user'})\n\t        .c('item', {affiliation: 'none', role: 'none'})\n\t        .up().up()\n\t        .c('roomtype', {xmlns: 'easemob:x:roomtype', type: 'chatroom'});\n\n\t    this.context.stropheConn.sendIQ(iq.tree(), suc, errorFn);\n\t};\n\n\tconnection.prototype._onReceiveInviteFromGroup = function (info) {\n\t    info = eval('(' + info + ')');\n\t    var options = {\n\t        title: \"Group invitation\",\n\t        msg: info.user + \" invites you to join into group:\" + info.group_id,\n\t        agree: function agree() {\n\t            WebIM.doQuery('{\"type\":\"acceptInvitationFromGroup\",\"id\":\"' + info.group_id + '\",\"user\":\"' + info.user + '\"}', function (response) {\n\t            }, function (code, msg) {\n\t                Demo.api.NotifyError(\"acceptInvitationFromGroup error:\" + msg);\n\t            });\n\n\t        },\n\t        reject: function reject() {\n\t            WebIM.doQuery('{\"type\":\"declineInvitationFromGroup\",\"id\":\"' + info.group_id + '\",\"user\":\"' + info.user + '\"}', function (response) {\n\t            }, function (code, msg) {\n\t                Demo.api.NotifyError(\"declineInvitationFromGroup error:\" + msg);\n\t            });\n\t        }\n\t    };\n\n\t    this.onConfirmPop(options);\n\t};\n\tconnection.prototype._onReceiveInviteAcceptionFromGroup = function (info) {\n\t    info = eval('(' + info + ')');\n\t    var options = {\n\t        title: \"Group invitation response\",\n\t        msg: info.user + \" agreed to join into group:\" + info.group_id,\n\t        agree: function agree() {\n\t        }\n\t    };\n\t    this.onConfirmPop(options);\n\t};\n\tconnection.prototype._onReceiveInviteDeclineFromGroup = function (info) {\n\t    info = eval('(' + info + ')');\n\t    var options = {\n\t        title: \"Group invitation response\",\n\t        msg: info.user + \" rejected to join into group:\" + info.group_id,\n\t        agree: function agree() {\n\t        }\n\t    };\n\t    this.onConfirmPop(options);\n\t};\n\tconnection.prototype._onAutoAcceptInvitationFromGroup = function (info) {\n\t    info = eval('(' + info + ')');\n\t    var options = {\n\t        title: \"Group invitation\",\n\t        msg: \"You had joined into the group:\" + info.group_name + \" automatically.Inviter:\" + info.user,\n\t        agree: function agree() {\n\t        }\n\t    };\n\t    this.onConfirmPop(options);\n\t};\n\tconnection.prototype._onLeaveGroup = function (info) {\n\t    info = eval('(' + info + ')');\n\t    var options = {\n\t        title: \"Group notification\",\n\t        msg: \"You have been out of the group:\" + info.group_id + \".Reason:\" + info.msg,\n\t        agree: function agree() {\n\t        }\n\t    };\n\t    this.onConfirmPop(options);\n\t};\n\tconnection.prototype._onReceiveJoinGroupApplication = function (info) {\n\t    info = eval('(' + info + ')');\n\t    var options = {\n\t        title: \"Group join application\",\n\t        msg: info.user + \" applys to join into group:\" + info.group_id,\n\t        agree: function agree() {\n\t            WebIM.doQuery('{\"type\":\"acceptJoinGroupApplication\",\"id\":\"' + info.group_id + '\",\"user\":\"' + info.user + '\"}', function (response) {\n\t            }, function (code, msg) {\n\t                Demo.api.NotifyError(\"acceptJoinGroupApplication error:\" + msg);\n\t            });\n\t        },\n\t        reject: function reject() {\n\t            WebIM.doQuery('{\"type\":\"declineJoinGroupApplication\",\"id\":\"' + info.group_id + '\",\"user\":\"' + info.user + '\"}', function (response) {\n\t            }, function (code, msg) {\n\t                Demo.api.NotifyError(\"declineJoinGroupApplication error:\" + msg);\n\t            });\n\t        }\n\t    };\n\t    this.onConfirmPop(options);\n\t};\n\tconnection.prototype._onReceiveAcceptionFromGroup = function (info) {\n\t    info = eval('(' + info + ')');\n\t    var options = {\n\t        title: \"Group notification\",\n\t        msg: \"You had joined into the group:\" + info.group_name + \".\",\n\t        agree: function agree() {\n\t        }\n\t    };\n\t    this.onConfirmPop(options);\n\t};\n\tconnection.prototype._onReceiveRejectionFromGroup = function () {\n\t    info = eval('(' + info + ')');\n\t    var options = {\n\t        title: \"Group notification\",\n\t        msg: \"You have been rejected to join into the group:\" + info.group_name + \".\",\n\t        agree: function agree() {\n\t        }\n\t    };\n\t    this.onConfirmPop(options);\n\t};\n\tconnection.prototype._onUpdateMyGroupList = function (options) {\n\t    this.onUpdateMyGroupList(options);\n\t};\n\tconnection.prototype._onUpdateMyRoster = function (options) {\n\t    this.onUpdateMyRoster(options);\n\t};\n\tconnection.prototype.reconnect = function () {\n\t    var that = this;\n\t    setTimeout(function () {\n\t        _login(that.context.restTokenData, that);\n\t    }, (this.autoReconnectNumTotal == 0 ? 0 : this.autoReconnectInterval) * 1000);\n\t    this.autoReconnectNumTotal++;\n\t};\n\tconnection.prototype.closed = function () {\n\t    Demo.api.init();\n\t};\n\n\t// used for blacklist\n\tfunction _parsePrivacy(iq) {\n\t    var list = [];\n\t    var items = iq.getElementsByTagName('item');\n\n\t    if (items) {\n\t        for (var i = 0; i < items.length; i++) {\n\t            var item = items[i];\n\t            var jid = item.getAttribute('value');\n\t            var order = item.getAttribute('order');\n\t            var type = item.getAttribute('type');\n\t            if (!jid) {\n\t                continue;\n\t            }\n\t            var n = _parseNameFromJidFn(jid);\n\t            list[n] = {\n\t                type: type,\n\t                order: order,\n\t                jid: jid,\n\t                name: n\n\t            };\n\t        }\n\t    }\n\t    return list;\n\t};\n\n\t// used for blacklist\n\tconnection.prototype.getBlacklist = function (options) {\n\t    options = (options || {});\n\t    var iq = $iq({type: 'get'});\n\t    var sucFn = options.success || _utils.emptyfn;\n\t    var errFn = options.error || _utils.emptyfn;\n\t    var me = this;\n\n\t    iq.c('query', {xmlns: 'jabber:iq:privacy'})\n\t        .c('list', {name: 'special'});\n\n\t    this.context.stropheConn.sendIQ(iq.tree(), function (iq) {\n\t        me.onBlacklistUpdate(_parsePrivacy(iq));\n\t        sucFn();\n\t    }, function () {\n\t        me.onBlacklistUpdate([]);\n\t        errFn();\n\t    });\n\t};\n\n\t// used for blacklist\n\tconnection.prototype.addToBlackList = function (options) {\n\t    var iq = $iq({type: 'set'});\n\t    var blacklist = options.list || {};\n\t    var type = options.type || 'jid';\n\t    var sucFn = options.success || _utils.emptyfn;\n\t    var errFn = options.error || _utils.emptyfn;\n\t    var piece = iq.c('query', {xmlns: 'jabber:iq:privacy'})\n\t        .c('list', {name: 'special'});\n\n\t    var keys = Object.keys(blacklist);\n\t    var len = keys.length;\n\t    var order = 2;\n\n\t    for (var i = 0; i < len; i++) {\n\t        var item = blacklist[keys[i]];\n\t        var type = item.type || 'jid';\n\t        var jid = item.jid;\n\n\t        piece = piece.c('item', {action: 'deny', order: order++, type: type, value: jid})\n\t            .c('message');\n\t        if (i !== len - 1) {\n\t            piece = piece.up().up();\n\t        }\n\t    }\n\n\t    // log('addToBlackList', blacklist, piece.tree());\n\t    this.context.stropheConn.sendIQ(piece.tree(), sucFn, errFn);\n\t};\n\n\t// used for blacklist\n\tconnection.prototype.removeFromBlackList = function (options) {\n\n\t    var iq = $iq({type: 'set'});\n\t    var blacklist = options.list || {};\n\t    var sucFn = options.success || _utils.emptyfn;\n\t    var errFn = options.error || _utils.emptyfn;\n\t    var piece = iq.c('query', {xmlns: 'jabber:iq:privacy'})\n\t        .c('list', {name: 'special'});\n\n\t    var keys = Object.keys(blacklist);\n\t    var len = keys.length;\n\n\t    for (var i = 0; i < len; i++) {\n\t        var item = blacklist[keys[i]];\n\t        var type = item.type || 'jid';\n\t        var jid = item.jid;\n\t        var order = item.order;\n\n\t        piece = piece.c('item', {action: 'deny', order: order, type: type, value: jid})\n\t            .c('message');\n\t        if (i !== len - 1) {\n\t            piece = piece.up().up();\n\t        }\n\t    }\n\n\t    // log('removeFromBlackList', blacklist, piece.tree());\n\t    this.context.stropheConn.sendIQ(piece.tree(), sucFn, errFn);\n\t};\n\n\tconnection.prototype._getGroupJid = function (to) {\n\t    var appKey = this.context.appKey || '';\n\t    return appKey + '_' + to + '@conference.' + this.domain;\n\t};\n\n\t// used for blacklist\n\tconnection.prototype.addToGroupBlackList = function (options) {\n\t    var sucFn = options.success || _utils.emptyfn;\n\t    var errFn = options.error || _utils.emptyfn;\n\t    var jid = _getJid(options, this);\n\t    var affiliation = 'admin';//options.affiliation || 'admin';\n\t    var to = this._getGroupJid(options.roomId);\n\t    var iq = $iq({type: 'set', to: to});\n\n\t    iq.c('query', {xmlns: 'http://jabber.org/protocol/muc#' + affiliation})\n\t        .c('item', {\n\t            affiliation: 'outcast',\n\t            jid: jid\n\t        });\n\n\t    this.context.stropheConn.sendIQ(iq.tree(), sucFn, errFn);\n\t};\n\n\tfunction _parseGroupBlacklist(iq) {\n\t    var list = {};\n\t    var items = iq.getElementsByTagName('item');\n\n\t    if (items) {\n\t        for (var i = 0; i < items.length; i++) {\n\t            var item = items[i];\n\t            var jid = item.getAttribute('jid');\n\t            var affiliation = item.getAttribute('affiliation');\n\t            var nick = item.getAttribute('nick');\n\t            if (!jid) {\n\t                continue;\n\t            }\n\t            var n = _parseNameFromJidFn(jid);\n\t            list[n] = {\n\t                jid: jid,\n\t                affiliation: affiliation,\n\t                nick: nick,\n\t                name: n\n\t            };\n\t        }\n\t    }\n\t    return list;\n\t}\n\n\t// used for blacklist\n\tconnection.prototype.getGroupBlacklist = function (options) {\n\t    var sucFn = options.success || _utils.emptyfn;\n\t    var errFn = options.error || _utils.emptyfn;\n\n\t    // var jid = _getJid(options, this);\n\t    var affiliation = 'admin';//options.affiliation || 'admin';\n\t    var to = this._getGroupJid(options.roomId);\n\t    var iq = $iq({type: 'get', to: to});\n\n\t    iq.c('query', {xmlns: 'http://jabber.org/protocol/muc#' + affiliation})\n\t        .c('item', {\n\t            affiliation: 'outcast',\n\t        });\n\n\t    this.context.stropheConn.sendIQ(iq.tree(), function (msginfo) {\n\t        log('getGroupBlackList');\n\t        sucFn(_parseGroupBlacklist(msginfo));\n\t    }, function () {\n\t        errFn();\n\t    });\n\t};\n\n\t// used for blacklist\n\tconnection.prototype.removeGroupMemberFromBlacklist = function (options) {\n\t    var sucFn = options.success || _utils.emptyfn;\n\t    var errFn = options.error || _utils.emptyfn;\n\n\t    var jid = _getJid(options, this);\n\t    var affiliation = 'admin';//options.affiliation || 'admin';\n\t    var to = this._getGroupJid(options.roomId);\n\t    var iq = $iq({type: 'set', to: to});\n\n\t    iq.c('query', {xmlns: 'http://jabber.org/protocol/muc#' + affiliation})\n\t        .c('item', {\n\t            affiliation: 'member',\n\t            jid: jid\n\t        });\n\n\t    this.context.stropheConn.sendIQ(iq.tree(), function (msginfo) {\n\t        sucFn();\n\t    }, function () {\n\t        errFn();\n\t    });\n\t};\n\n\t/**\n\t * changeGroupSubject 修改群名称\n\t *\n\t * @param options\n\t */\n\t// <iq to='easemob-demo#chatdemoui_roomid@conference.easemob.com' type='set' id='3940489311' xmlns='jabber:client'>\n\t//     <query xmlns='http://jabber.org/protocol/muc#owner'>\n\t//         <x type='submit' xmlns='jabber:x:data'>\n\t//             <field var='FORM_TYPE'><value>http://jabber.org/protocol/muc#roomconfig</value></field>\n\t//             <field var='muc#roomconfig_roomname'><value>Room Name</value></field>\n\t//         </x>\n\t//     </query>\n\t// </iq>\n\tconnection.prototype.changeGroupSubject = function (options) {\n\t    var sucFn = options.success || _utils.emptyfn;\n\t    var errFn = options.error || _utils.emptyfn;\n\n\t    // must be `owner`\n\t    var affiliation = 'owner';\n\t    var to = this._getGroupJid(options.roomId);\n\t    var iq = $iq({type: 'set', to: to});\n\n\t    iq.c('query', {xmlns: 'http://jabber.org/protocol/muc#' + affiliation})\n\t        .c('x', {type: 'submit', xmlns: 'jabber:x:data'})\n\t        .c('field', {var: 'FORM_TYPE'})\n\t        .c('value')\n\t        .t('http://jabber.org/protocol/muc#roomconfig')\n\t        .up().up()\n\t        .c('field', {var: 'muc#roomconfig_roomname'})\n\t        .c('value')\n\t        .t(options.subject)\n\t        .up().up()\n\t        .c('field', {var: 'muc#roomconfig_roomdesc'})\n\t        .c('value')\n\t        .t(options.description);\n\n\n\t    this.context.stropheConn.sendIQ(iq.tree(), function (msginfo) {\n\t        sucFn();\n\t    }, function () {\n\t        errFn();\n\t    });\n\t};\n\n\t/**\n\t * destroyGroup 删除群组\n\t *\n\t * @param options\n\t */\n\t// <iq id=\"9BEF5D20-841A-4048-B33A-F3F871120E58\" to=\"easemob-demo#chatdemoui_1477462231499@conference.easemob.com\" type=\"set\">\n\t//     <query xmlns=\"http://jabber.org/protocol/muc#owner\">\n\t//         <destroy>\n\t//             <reason>xxx destory group yyy</reason>\n\t//         </destroy>\n\t//     </query>\n\t// </iq>\n\tconnection.prototype.destroyGroup = function (options) {\n\t    var sucFn = options.success || _utils.emptyfn;\n\t    var errFn = options.error || _utils.emptyfn;\n\n\t    // must be `owner`\n\t    var affiliation = 'owner';\n\t    var to = this._getGroupJid(options.roomId);\n\t    var iq = $iq({type: 'set', to: to});\n\n\t    iq.c('query', {xmlns: 'http://jabber.org/protocol/muc#' + affiliation})\n\t        .c('destroy')\n\t        .c('reason').t(options.reason || '');\n\n\t    this.context.stropheConn.sendIQ(iq.tree(), function (msginfo) {\n\t        sucFn();\n\t    }, function () {\n\t        errFn();\n\t    });\n\t};\n\n\t/**\n\t * leaveGroupBySelf 主动离开群组\n\t *\n\t * @param options\n\t */\n\t// <iq id=\"5CD33172-7B62-41B7-98BC-CE6EF840C4F6_easemob_occupants_change_affiliation\" to=\"easemob-demo#chatdemoui_1477481609392@conference.easemob.com\" type=\"set\">\n\t//     <query xmlns=\"http://jabber.org/protocol/muc#admin\">\n\t//         <item affiliation=\"none\" jid=\"easemob-demo#chatdemoui_lwz2@easemob.com\"/>\n\t//     </query>\n\t// </iq>\n\tconnection.prototype.leaveGroupBySelf = function (options) {\n\t    var sucFn = options.success || _utils.emptyfn;\n\t    var errFn = options.error || _utils.emptyfn;\n\n\t    // must be `owner`\n\t    var jid = _getJid(options, this);\n\t    var affiliation = 'admin';\n\t    var to = this._getGroupJid(options.roomId);\n\t    var iq = $iq({type: 'set', to: to});\n\n\t    iq.c('query', {xmlns: 'http://jabber.org/protocol/muc#' + affiliation})\n\t        .c('item', {\n\t            affiliation: 'none',\n\t            jid: jid\n\t        });\n\n\t    this.context.stropheConn.sendIQ(iq.tree(), function (msgInfo) {\n\t        sucFn(msgInfo);\n\t    }, function (errInfo) {\n\t        errFn(errInfo);\n\t    });\n\t};\n\n\t/**\n\t * leaveGroup 被踢出群组\n\t *\n\t * @param options\n\t */\n\t// <iq id=\"9fb25cf4-1183-43c9-961e-9df70e300de4:sendIQ\" to=\"easemob-demo#chatdemoui_1477481597120@conference.easemob.com\" type=\"set\" xmlns=\"jabber:client\">\n\t//     <query xmlns=\"http://jabber.org/protocol/muc#admin\">\n\t//         <item affiliation=\"none\" jid=\"easemob-demo#chatdemoui_lwz4@easemob.com\"/>\n\t//         <item jid=\"easemob-demo#chatdemoui_lwz4@easemob.com\" role=\"none\"/>\n\t//         <item affiliation=\"none\" jid=\"easemob-demo#chatdemoui_lwz2@easemob.com\"/>\n\t//         <item jid=\"easemob-demo#chatdemoui_lwz2@easemob.com\" role=\"none\"/>\n\t//     </query>\n\t// </iq>\n\tconnection.prototype.leaveGroup = function (options) {\n\t    var sucFn = options.success || _utils.emptyfn;\n\t    var errFn = options.error || _utils.emptyfn;\n\t    var list = options.list || [];\n\t    var affiliation = 'admin';\n\t    var to = this._getGroupJid(options.roomId);\n\t    var iq = $iq({type: 'set', to: to});\n\t    var piece = iq.c('query', {xmlns: 'http://jabber.org/protocol/muc#' + affiliation});\n\t    var keys = Object.keys(list);\n\t    var len = keys.length;\n\n\t    for (var i = 0; i < len; i++) {\n\t        var name = list[keys[i]];\n\t        var jid = _getJidByName(name, this);\n\n\t        piece = piece.c('item', {\n\t            affiliation: 'none',\n\t            jid: jid\n\t        }).up().c('item', {\n\t            role: 'none',\n\t            jid: jid,\n\t        }).up();\n\t    }\n\n\t    this.context.stropheConn.sendIQ(iq.tree(), function (msgInfo) {\n\t        sucFn(msgInfo);\n\t    }, function (errInfo) {\n\t        errFn(errInfo);\n\t    });\n\t};\n\n\t/**\n\t * addGroupMembers 添加群组成员\n\t *\n\t * @param options\n\n\t Attention the sequence: message first (每个成员单独发一条message), iq second (多个成员可以合成一条iq发)\n\t <!-- 添加成员通知：send -->\n\t <message to='easemob-demo#chatdemoui_1477482739698@conference.easemob.com'>\n\t <x xmlns='http://jabber.org/protocol/muc#user'>\n\t <invite to='easemob-demo#chatdemoui_lwz2@easemob.com'>\n\t <reason>liuwz invite you to join group '谢谢'</reason>\n\t </invite>\n\t </x>\n\t </message>\n\t <!-- 添加成员：send -->\n\t <iq id='09DFB1E5-C939-4C43-B5A7-8000DA0E3B73_easemob_occupants_change_affiliation' to='easemob-demo#chatdemoui_1477482739698@conference.easemob.com' type='set'>\n\t <query xmlns='http://jabber.org/protocol/muc#admin'>\n\t <item affiliation='member' jid='easemob-demo#chatdemoui_lwz2@easemob.com'/>\n\t </query>\n\t </iq>\n\t */\n\n\tconnection.prototype.addGroupMembers = function (options) {\n\t    var sucFn = options.success || _utils.emptyfn;\n\t    var errFn = options.error || _utils.emptyfn;\n\t    var list = options.list || [];\n\t    var affiliation = 'admin';\n\t    var to = this._getGroupJid(options.roomId);\n\t    var iq = $iq({type: 'set', to: to});\n\t    var piece = iq.c('query', {xmlns: 'http://jabber.org/protocol/muc#' + affiliation});\n\t    var len = list.length;\n\n\t    for (var i = 0; i < len; i++) {\n\n\t        var name = list[i];\n\t        var jid = _getJidByName(name, this);\n\n\t        piece = piece.c('item', {\n\t            affiliation: 'member',\n\t            jid: jid\n\t        }).up();\n\n\t        var dom = $msg({\n\t            to: to\n\t        }).c('x', {\n\t            xmlns: 'http://jabber.org/protocol/muc#user'\n\t        }).c('invite', {\n\t            to: jid\n\t        }).c('reason').t(options.reason || '');\n\n\t        this.sendCommand(dom.tree());\n\n\t    }\n\n\t    this.context.stropheConn.sendIQ(iq.tree(), function (msgInfo) {\n\t        sucFn(msgInfo);\n\t    }, function (errInfo) {\n\t        errFn(errInfo);\n\t    });\n\t};\n\n\t/**\n\t * acceptInviteFromGroup 接受加入申请\n\t *\n\t * @param options\n\t */\n\tconnection.prototype.acceptInviteFromGroup = function (options) {\n\t    options.success = function () {\n\t        // then send sendAcceptInviteMessage\n\t        // connection.prototype.sendAcceptInviteMessage(optoins);\n\t    };\n\t    this.addGroupMembers(options);\n\t};\n\n\t/**\n\t * rejectInviteFromGroup 拒绝入群申请\n\t *\n\t * throw request for now 暂时不处理，直接丢弃\n\t *\n\t <message to='easemob-demo#chatdemoui_mt002@easemob.com' from='easmeob-demo#chatdemoui_mt001@easemob.com' id='B83B7210-BCFF-4DEE-AB28-B9FE5579C1E2'>\n\t <x xmlns='http://jabber.org/protocol/muc#user'>\n\t <apply to='easemob-demo#chatdemoui_groupid1@conference.easemob.com' from='easmeob-demo#chatdemoui_mt001@easemob.com' toNick='llllll'>\n\t <reason>reject</reason>\n\t </apply>\n\t </x>\n\t </message>\n\t *\n\t * @param options\n\t */\n\tconnection.prototype.rejectInviteFromGroup = function (options) {\n\t    // var from = _getJidByName(options.from, this);\n\t    // var dom = $msg({\n\t    //     from: from,\n\t    //     to: _getJidByName(options.to, this)\n\t    // }).c('x', {\n\t    //     xmlns: 'http://jabber.org/protocol/muc#user'\n\t    // }).c('apply', {\n\t    //     from: from,\n\t    //     to: this._getGroupJid(options.groupId),\n\t    //     toNick: options.groupName\n\t    // }).c('reason').t(options.reason || '');\n\t    //\n\t    // this.sendCommand(dom.tree());\n\t};\n\n\t/**\n\t * createGroup 创建群组\n\t *\n\t * 1. 创建申请 -> 得到房主身份\n\t * 2. 获取房主信息 -> 得到房间form\n\t * 3. 完善房间form -> 创建成功\n\t * 4. 添加房间成员\n\t * 5. 消息通知成员\n\t * @param options\n\t */\n\tconnection.prototype.createGroup = function (options) {\n\t    var roomId = +new Date();\n\t    var toRoom = this._getGroupJid(roomId);\n\t    var to = toRoom + '/' + this.context.userId;\n\n\t    var pres = $pres({to: to})\n\t        .c('x', {xmlns: 'http://jabber.org/protocol/muc'}).up()\n\t        .c('create', {xmlns: 'http://jabber.org/protocol/muc'}).up();\n\t    // .c('c', {\n\t    //     hash: 'sha-1',\n\t    //     node: 'https://github.com/robbiehanson/XMPPFramework',\n\t    //     ver: 'k6gP4Ua5m4uu9YorAG0LRXM+kZY=',\n\t    //     xmlns: 'http://jabber.org/protocol/caps'\n\t    // }).up();\n\n\t    // createGroupACK\n\t    this.sendCommand(pres.tree());\n\n\t    var me = this;\n\t    // timeout hack for create group async\n\t    setTimeout(function () {\n\t        // Creating a Reserved Room\n\t        var iq = $iq({type: 'get', to: toRoom})\n\t            .c('query', {xmlns: 'http://jabber.org/protocol/muc#owner'});\n\n\t        // Strophe.info('step 1 ----------');\n\t        // Strophe.info(options);\n\t        me.context.stropheConn.sendIQ(iq.tree(), function (msgInfo) {\n\t            // log(msgInfo);\n\n\t            // for ie hack\n\t            if ('setAttribute' in msgInfo) {\n\t                // Strophe.info('step 3 ----------');\n\t                var x = msgInfo.getElementsByTagName('x')[0];\n\t                x.setAttribute('type', 'submit');\n\t            } else {\n\t                // Strophe.info('step 4 ----------');\n\t                Strophe.forEachChild(msgInfo, 'x', function (field) {\n\t                    field.setAttribute('type', 'submit');\n\t                });\n\t            }\n\n\t            // var rcv = msgInfo.getElementsByTagName('x');\n\t            // var v;\n\t            // if (rcv.length > 0) {\n\t            //     if (rcv[0].childNodes && rcv[0].childNodes.length > 0) {\n\t            //         v = rcv[0].childNodes[0].nodeValue;\n\t            //     } else {\n\t            //         v = rcv[0].innerHTML || rcv[0].innerText\n\t            //     }\n\t            //     mid = rcv[0].getAttribute('mid');\n\t            // }\n\t            Strophe.info('step 5 ----------');\n\t            Strophe.forEachChild(x, 'field', function (field) {\n\t                var fieldVar = field.getAttribute('var');\n\t                var valueDom = field.getElementsByTagName('value')[0];\n\t                Strophe.info(fieldVar);\n\t                switch (fieldVar) {\n\t                    case 'muc#roomconfig_roomname':\n\t                        _setText(valueDom, options.subject || '');\n\t                        break;\n\t                    case 'muc#roomconfig_roomdesc':\n\t                        _setText(valueDom, options.description || '');\n\t                        break;\n\t                    case 'muc#roomconfig_publicroom': // public 1\n\t                        _setText(valueDom, +options.optionsPublic);\n\t                        break;\n\t                    case 'muc#roomconfig_membersonly':\n\t                        _setText(valueDom, +options.optionsMembersOnly);\n\t                        break;\n\t                    case 'muc#roomconfig_moderatedroom':\n\t                        _setText(valueDom, +options.optionsModerate);\n\t                        break;\n\t                    case 'muc#roomconfig_persistentroom':\n\t                        _setText(valueDom, 1);\n\t                        break;\n\t                    case 'muc#roomconfig_allowinvites':\n\t                        _setText(valueDom, +options.optionsAllowInvites);\n\t                        break;\n\t                    case 'muc#roomconfig_allowvisitornickchange':\n\t                        _setText(valueDom, 0);\n\t                        break;\n\t                    case 'muc#roomconfig_allowvisitorstatus':\n\t                        _setText(valueDom, 0);\n\t                        break;\n\t                    case 'allow_private_messages':\n\t                        _setText(valueDom, 0);\n\t                        break;\n\t                    case 'allow_private_messages_from_visitors':\n\t                        _setText(valueDom, 'nobody');\n\t                        break;\n\t                    default:\n\t                        break;\n\t                }\n\t                // log(valueDom);\n\t            });\n\n\t            var iq = $iq({to: toRoom, type: 'set'})\n\t                .c('query', {xmlns: 'http://jabber.org/protocol/muc#owner'})\n\t                .cnode(x);\n\n\t            // log(iq.tree());\n\n\t            me.context.stropheConn.sendIQ(iq.tree(), function (msgInfo) {\n\t                // sucFn(msgInfo);\n\n\t                me.addGroupMembers({\n\t                    list: options.members,\n\t                    roomId: roomId\n\t                });\n\t            }, function (errInfo) {\n\t                // errFn(errInfo);\n\t            });\n\t            // sucFn(msgInfo);\n\t        }, function (errInfo) {\n\t            // errFn(errInfo);\n\t        });\n\t    }, 1000);\n\t};\n\n\tfunction _setText(valueDom, v) {\n\t    if ('textContent' in valueDom) {\n\t        valueDom.textContent = v;\n\t    } else if ('text' in valueDom) {\n\t        valueDom.text = v;\n\t    } else {\n\t        // Strophe.info('_setText 4 ----------');\n\t        // valueDom.innerHTML = v;\n\t    }\n\t}\n\n\n\tvar WebIM = window.WebIM || {};\n\tWebIM.connection = connection;\n\tWebIM.utils = _utils;\n\tWebIM.statusCode = _code;\n\tWebIM.message = _msg.message;\n\tWebIM.doQuery = function (str, suc, fail) {\n\t    if (typeof window.cefQuery === 'undefined') {\n\t        return;\n\t    }\n\t    window.cefQuery({\n\t            request: str,\n\t            persistent: false,\n\t            onSuccess: suc,\n\t            onFailure: fail\n\t        }\n\t    );\n\t};\n\n\tmodule.exports = WebIM;\n\n\tif (false) {\n\t    module.hot.accept();\n\t}\n\n/***/ },\n/* 2 */\n/***/ function(module, exports) {\n\n\t;\n\t(function () {\n\t    var connIndex = 0,\n\t        uploadIndex = 100,\n\t        downloadIndex = 200,\n\t        msgIndex = 300,\n\t        statusIndex = 400;\n\n\t    exports.code = {\n\t        WEBIM_CONNCTION_USER_NOT_ASSIGN_ERROR: connIndex++,\n\t        WEBIM_CONNCTION_OPEN_ERROR: connIndex++,\n\t        WEBIM_CONNCTION_AUTH_ERROR: connIndex++,\n\t        WEBIM_CONNCTION_OPEN_USERGRID_ERROR: connIndex++,\n\t        WEBIM_CONNCTION_ATTACH_ERROR: connIndex++,\n\t        WEBIM_CONNCTION_ATTACH_USERGRID_ERROR: connIndex++,\n\t        WEBIM_CONNCTION_REOPEN_ERROR: connIndex++,\n\t        WEBIM_CONNCTION_SERVER_CLOSE_ERROR: connIndex++,  //7: client-side network offline (net::ERR_INTERNET_DISCONNECTED)\n\t        WEBIM_CONNCTION_SERVER_ERROR: connIndex++,        //8: offline by multi login\n\t        WEBIM_CONNCTION_IQ_ERROR: connIndex++,\n\n\t        WEBIM_CONNCTION_PING_ERROR: connIndex++,\n\t        WEBIM_CONNCTION_NOTIFYVERSION_ERROR: connIndex++,\n\t        WEBIM_CONNCTION_GETROSTER_ERROR: connIndex++,\n\t        WEBIM_CONNCTION_CROSSDOMAIN_ERROR: connIndex++,\n\t        WEBIM_CONNCTION_LISTENING_OUTOF_MAXRETRIES: connIndex++,\n\t        WEBIM_CONNCTION_RECEIVEMSG_CONTENTERROR: connIndex++,\n\t        WEBIM_CONNCTION_DISCONNECTED: connIndex++,    //16: server-side close the websocket connection\n\t        WEBIM_CONNCTION_AJAX_ERROR: connIndex++,\n\t        WEBIM_CONNCTION_JOINROOM_ERROR: connIndex++,\n\t        WEBIM_CONNCTION_GETROOM_ERROR: connIndex++,\n\n\t        WEBIM_CONNCTION_GETROOMINFO_ERROR: connIndex++,\n\t        WEBIM_CONNCTION_GETROOMMEMBER_ERROR: connIndex++,\n\t        WEBIM_CONNCTION_GETROOMOCCUPANTS_ERROR: connIndex++,\n\t        WEBIM_CONNCTION_LOAD_CHATROOM_ERROR: connIndex++,\n\t        WEBIM_CONNCTION_NOT_SUPPORT_CHATROOM_ERROR: connIndex++,\n\t        WEBIM_CONNCTION_JOINCHATROOM_ERROR: connIndex++,\n\t        WEBIM_CONNCTION_QUITCHATROOM_ERROR: connIndex++,\n\t        WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR: connIndex++,\n\t        WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR: connIndex++,\n\t        WEBIM_CONNCTION_SESSIONID_NOT_ASSIGN_ERROR: connIndex++,\n\n\t        WEBIM_CONNCTION_RID_NOT_ASSIGN_ERROR: connIndex++,\n\t        WEBIM_CONNCTION_CALLBACK_INNER_ERROR: connIndex++,\n\t        WEBIM_CONNCTION_CLIENT_OFFLINE: connIndex++,        //32: client offline\n\t        WEBIM_CONNCTION_CLIENT_LOGOUT: connIndex++,        //33: client logout\n\t        WEBIM_CONNCTION_CLIENT_TOO_MUCH_ERROR: connIndex++, // Over amount of the tabs a user opened in the same browser\n\n\n\t        WEBIM_UPLOADFILE_BROWSER_ERROR: uploadIndex++,\n\t        WEBIM_UPLOADFILE_ERROR: uploadIndex++,\n\t        WEBIM_UPLOADFILE_NO_LOGIN: uploadIndex++,\n\t        WEBIM_UPLOADFILE_NO_FILE: uploadIndex++,\n\n\n\t        WEBIM_DOWNLOADFILE_ERROR: downloadIndex++,\n\t        WEBIM_DOWNLOADFILE_NO_LOGIN: downloadIndex++,\n\t        WEBIM_DOWNLOADFILE_BROWSER_ERROR: downloadIndex++,\n\n\n\t        WEBIM_MESSAGE_REC_TEXT: msgIndex++,\n\t        WEBIM_MESSAGE_REC_TEXT_ERROR: msgIndex++,\n\t        WEBIM_MESSAGE_REC_EMOTION: msgIndex++,\n\t        WEBIM_MESSAGE_REC_PHOTO: msgIndex++,\n\t        WEBIM_MESSAGE_REC_AUDIO: msgIndex++,\n\t        WEBIM_MESSAGE_REC_AUDIO_FILE: msgIndex++,\n\t        WEBIM_MESSAGE_REC_VEDIO: msgIndex++,\n\t        WEBIM_MESSAGE_REC_VEDIO_FILE: msgIndex++,\n\t        WEBIM_MESSAGE_REC_FILE: msgIndex++,\n\t        WEBIM_MESSAGE_SED_TEXT: msgIndex++,\n\t        WEBIM_MESSAGE_SED_EMOTION: msgIndex++,\n\t        WEBIM_MESSAGE_SED_PHOTO: msgIndex++,\n\t        WEBIM_MESSAGE_SED_AUDIO: msgIndex++,\n\t        WEBIM_MESSAGE_SED_AUDIO_FILE: msgIndex++,\n\t        WEBIM_MESSAGE_SED_VEDIO: msgIndex++,\n\t        WEBIM_MESSAGE_SED_VEDIO_FILE: msgIndex++,\n\t        WEBIM_MESSAGE_SED_FILE: msgIndex++,\n\n\n\t        STATUS_INIT: statusIndex++,\n\t        STATUS_DOLOGIN_USERGRID: statusIndex++,\n\t        STATUS_DOLOGIN_IM: statusIndex++,\n\t        STATUS_OPENED: statusIndex++,\n\t        STATUS_CLOSING: statusIndex++,\n\t        STATUS_CLOSED: statusIndex++,\n\t        STATUS_ERROR: statusIndex++\n\t    };\n\t}());\n\n\n/***/ },\n/* 3 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t;\n\t(function () {\n\n\t    var EMPTYFN = function () {\n\t    };\n\t    var _code = __webpack_require__(2).code;\n\t    var WEBIM_FILESIZE_LIMIT = 10485760;\n\n\t    var _createStandardXHR = function () {\n\t        try {\n\t            return new window.XMLHttpRequest();\n\t        } catch (e) {\n\t            return false;\n\t        }\n\t    };\n\n\t    var _createActiveXHR = function () {\n\t        try {\n\t            return new window.ActiveXObject('Microsoft.XMLHTTP');\n\t        } catch (e) {\n\t            return false;\n\t        }\n\t    };\n\n\t    var _xmlrequest = function (crossDomain) {\n\t        crossDomain = crossDomain || true;\n\t        var temp = _createStandardXHR() || _createActiveXHR();\n\n\t        if ('withCredentials' in temp) {\n\t            return temp;\n\t        }\n\t        if (!crossDomain) {\n\t            return temp;\n\t        }\n\t        if (typeof window.XDomainRequest === 'undefined') {\n\t            return temp;\n\t        }\n\t        var xhr = new XDomainRequest();\n\t        xhr.readyState = 0;\n\t        xhr.status = 100;\n\t        xhr.onreadystatechange = EMPTYFN;\n\t        xhr.onload = function () {\n\t            xhr.readyState = 4;\n\t            xhr.status = 200;\n\n\t            var xmlDoc = new ActiveXObject('Microsoft.XMLDOM');\n\t            xmlDoc.async = 'false';\n\t            xmlDoc.loadXML(xhr.responseText);\n\t            xhr.responseXML = xmlDoc;\n\t            xhr.response = xhr.responseText;\n\t            xhr.onreadystatechange();\n\t        };\n\t        xhr.ontimeout = xhr.onerror = function () {\n\t            xhr.readyState = 4;\n\t            xhr.status = 500;\n\t            xhr.onreadystatechange();\n\t        };\n\t        return xhr;\n\t    };\n\n\t    var _hasFlash = (function () {\n\t        if ('ActiveXObject' in window) {\n\t            try {\n\t                return new ActiveXObject('ShockwaveFlash.ShockwaveFlash');\n\t            } catch (ex) {\n\t                return 0;\n\t            }\n\t        } else {\n\t            if (navigator.plugins && navigator.plugins.length > 0) {\n\t                return navigator.plugins['Shockwave Flash'];\n\t            }\n\t        }\n\t        return 0;\n\t    }());\n\n\t    var _tmpUtilXHR = _xmlrequest(),\n\t        _hasFormData = typeof FormData !== 'undefined',\n\t        _hasBlob = typeof Blob !== 'undefined',\n\t        _isCanSetRequestHeader = _tmpUtilXHR.setRequestHeader || false,\n\t        _hasOverrideMimeType = _tmpUtilXHR.overrideMimeType || false,\n\t        _isCanUploadFileAsync = _isCanSetRequestHeader && _hasFormData,\n\t        _isCanUploadFile = _isCanUploadFileAsync || _hasFlash,\n\t        _isCanDownLoadFile = _isCanSetRequestHeader && (_hasBlob || _hasOverrideMimeType);\n\n\t    if (!Object.keys) {\n\t        Object.keys = (function () {\n\t            'use strict';\n\t            var hasOwnProperty = Object.prototype.hasOwnProperty,\n\t                hasDontEnumBug = !({toString: null}).propertyIsEnumerable('toString'),\n\t                dontEnums = [\n\t                    'toString',\n\t                    'toLocaleString',\n\t                    'valueOf',\n\t                    'hasOwnProperty',\n\t                    'isPrototypeOf',\n\t                    'propertyIsEnumerable',\n\t                    'constructor'\n\t                ],\n\t                dontEnumsLength = dontEnums.length;\n\n\t            return function (obj) {\n\t                if (typeof obj !== 'object' && (typeof obj !== 'function' || obj === null)) {\n\t                    throw new TypeError('Object.keys called on non-object');\n\t                }\n\n\t                var result = [], prop, i;\n\n\t                for (prop in obj) {\n\t                    if (hasOwnProperty.call(obj, prop)) {\n\t                        result.push(prop);\n\t                    }\n\t                }\n\n\t                if (hasDontEnumBug) {\n\t                    for (i = 0; i < dontEnumsLength; i++) {\n\t                        if (hasOwnProperty.call(obj, dontEnums[i])) {\n\t                            result.push(dontEnums[i]);\n\t                        }\n\t                    }\n\t                }\n\t                return result;\n\t            };\n\t        }());\n\t    }\n\n\t    var utils = {\n\t        hasFormData: _hasFormData,\n\n\t        hasBlob: _hasBlob,\n\n\t        emptyfn: EMPTYFN,\n\n\t        isCanSetRequestHeader: _isCanSetRequestHeader,\n\n\t        hasOverrideMimeType: _hasOverrideMimeType,\n\n\t        isCanUploadFileAsync: _isCanUploadFileAsync,\n\n\t        isCanUploadFile: _isCanUploadFile,\n\n\t        isCanDownLoadFile: _isCanDownLoadFile,\n\n\t        isSupportWss: (function () {\n\t            var notSupportList = [\n\t                //1: QQ browser X5 core\n\t                /MQQBrowser[\\/]5([.]\\d+)?\\sTBS/\n\n\t                //2: etc.\n\t                //...\n\t            ];\n\n\t            if (!window.WebSocket) {\n\t                return false;\n\t            }\n\n\t            var ua = window.navigator.userAgent;\n\t            for (var i = 0, l = notSupportList.length; i < l; i++) {\n\t                if (notSupportList[i].test(ua)) {\n\t                    return false;\n\t                }\n\t            }\n\t            return true;\n\t        }()),\n\n\t        getIEVersion: (function () {\n\t            var ua = navigator.userAgent, matches, tridentMap = {'4': 8, '5': 9, '6': 10, '7': 11};\n\n\t            matches = ua.match(/MSIE (\\d+)/i);\n\n\t            if (matches && matches[1]) {\n\t                return +matches[1];\n\t            }\n\t            matches = ua.match(/Trident\\/(\\d+)/i);\n\t            if (matches && matches[1]) {\n\t                return tridentMap[matches[1]] || null;\n\t            }\n\t            return null;\n\t        }()),\n\n\n\t        stringify: function (json) {\n\t            if (typeof JSON !== 'undefined' && JSON.stringify) {\n\t                return JSON.stringify(json);\n\t            } else {\n\t                var s = '',\n\t                    arr = [];\n\n\t                var iterate = function (json) {\n\t                    var isArr = false;\n\n\t                    if (Object.prototype.toString.call(json) === '[object Array]') {\n\t                        arr.push(']', '[');\n\t                        isArr = true;\n\t                    } else if (Object.prototype.toString.call(json) === '[object Object]') {\n\t                        arr.push('}', '{');\n\t                    }\n\n\t                    for (var o in json) {\n\t                        if (Object.prototype.toString.call(json[o]) === '[object Null]') {\n\t                            json[o] = 'null';\n\t                        } else if (Object.prototype.toString.call(json[o]) === '[object Undefined]') {\n\t                            json[o] = 'undefined';\n\t                        }\n\n\t                        if (json[o] && typeof json[o] === 'object') {\n\t                            s += ',' + (isArr ? '' : '\"' + o + '\":' + (isArr ? '\"' : '')) + iterate(json[o]) + '';\n\t                        } else {\n\t                            s += ',\"' + (isArr ? '' : o + '\":\"') + json[o] + '\"';\n\t                        }\n\t                    }\n\n\t                    if (s != '') {\n\t                        s = s.slice(1);\n\t                    }\n\n\t                    return arr.pop() + s + arr.pop();\n\t                };\n\t                return iterate(json);\n\t            }\n\t        },\n\t        registerUser: function (options) {\n\t            if (location.protocol != 'https:' && WebIM.config.isHttpDNS) {\n\t                Demo.conn.dnsIndex = 0;\n\t                Demo.conn.getHttpDNS(options, 'signup');\n\t            } else {\n\t                Demo.conn.signup(options);\n\t            }\n\n\t        },\n\t        login: function (options) {\n\t            var options = options || {};\n\t            var suc = options.success || EMPTYFN;\n\t            var err = options.error || EMPTYFN;\n\n\t            var appKey = options.appKey || '';\n\t            var devInfos = appKey.split('#');\n\t            if (devInfos.length !== 2) {\n\t                err({\n\t                    type: _code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR\n\t                });\n\t                return false;\n\t            }\n\n\t            var orgName = devInfos[0];\n\t            var appName = devInfos[1];\n\t            var https = https || options.https;\n\t            var user = options.user || '';\n\t            var pwd = options.pwd || '';\n\n\t            var apiUrl = options.apiUrl;\n\n\t            var loginJson = {\n\t                grant_type: 'password',\n\t                username: user,\n\t                password: pwd,\n\t                timestamp: +new Date()\n\t            };\n\t            var loginfo = utils.stringify(loginJson);\n\n\t            var options = {\n\t                url: apiUrl + '/' + orgName + '/' + appName + '/token',\n\t                dataType: 'json',\n\t                data: loginfo,\n\t                success: suc,\n\t                error: err\n\t            };\n\t            return utils.ajax(options);\n\t        },\n\n\t        getFileUrl: function (fileInputId) {\n\t            var uri = {\n\t                url: '',\n\t                filename: '',\n\t                filetype: '',\n\t                data: ''\n\t            };\n\n\t            var fileObj = typeof fileInputId === 'string' ? document.getElementById(fileInputId) : fileInputId;\n\n\t            if (!utils.isCanUploadFileAsync || !fileObj) {\n\t                return uri;\n\t            }\n\t            try {\n\t                if (window.URL.createObjectURL) {\n\t                    var fileItems = fileObj.files;\n\t                    if (fileItems.length > 0) {\n\t                        var u = fileItems.item(0);\n\t                        uri.data = u;\n\t                        uri.url = window.URL.createObjectURL(u);\n\t                        uri.filename = u.name || '';\n\t                    }\n\t                } else { // IE\n\t                    var u = document.getElementById(fileInputId).value;\n\t                    uri.url = u;\n\t                    var pos1 = u.lastIndexOf('/');\n\t                    var pos2 = u.lastIndexOf('\\\\');\n\t                    var pos = Math.max(pos1, pos2);\n\t                    if (pos < 0)\n\t                        uri.filename = u;\n\t                    else\n\t                        uri.filename = u.substring(pos + 1);\n\t                }\n\t                var index = uri.filename.lastIndexOf('.');\n\t                if (index != -1) {\n\t                    uri.filetype = uri.filename.substring(index + 1).toLowerCase();\n\t                }\n\t                return uri;\n\n\t            } catch (e) {\n\t                throw e;\n\t            }\n\t        },\n\n\t        getFileSize: function (fileInputId) {\n\t            var file = document.getElementById(fileInputId);\n\t            var fileSize = 0;\n\t            if (file) {\n\t                if (file.files) {\n\t                    if (file.files.length > 0) {\n\t                        fileSize = file.files[0].size;\n\t                    }\n\t                } else if (file.select && 'ActiveXObject' in window) {\n\t                    file.select();\n\t                    var fileobject = new ActiveXObject('Scripting.FileSystemObject');\n\t                    var file = fileobject.GetFile(file.value);\n\t                    fileSize = file.Size;\n\t                }\n\t            }\n\t            return fileSize;\n\t        },\n\n\t        hasFlash: _hasFlash,\n\n\t        trim: function (str) {\n\n\t            str = typeof str === 'string' ? str : '';\n\n\t            return str.trim\n\t                ? str.trim()\n\t                : str.replace(/^\\s|\\s$/g, '');\n\t        },\n\n\t        parseEmoji: function (msg) {\n\t            if (typeof WebIM.Emoji === 'undefined' || typeof WebIM.Emoji.map === 'undefined') {\n\t                return msg;\n\t            } else {\n\t                var emoji = WebIM.Emoji,\n\t                    reg = null;\n\n\t                for (var face in emoji.map) {\n\t                    if (emoji.map.hasOwnProperty(face)) {\n\t                        while (msg.indexOf(face) > -1) {\n\t                            msg = msg.replace(face, '<img class=\"emoji\" src=\"' + emoji.path + emoji.map[face] + '\" />');\n\t                        }\n\t                    }\n\t                }\n\t                return msg;\n\t            }\n\t        },\n\n\t        parseLink: function (msg) {\n\n\t            var reg = /(https?\\:\\/\\/|www\\.)([a-zA-Z0-9-]+(\\.[a-zA-Z0-9]+)+)(\\:[0-9]{2,4})?\\/?((\\.[:_0-9a-zA-Z-]+)|[:_0-9a-zA-Z-]*\\/?)*\\??[:_#@*&%0-9a-zA-Z-/=]*/gm;\n\n\t            msg = msg.replace(reg, function (v) {\n\n\t                var prefix = /^https?/gm.test(v);\n\n\t                return \"<a href='\"\n\t                    + (prefix ? v : '//' + v)\n\t                    + \"' target='_blank'>\"\n\t                    + v\n\t                    + \"</a>\";\n\n\t            });\n\n\t            return msg;\n\n\t        },\n\n\t        parseJSON: function (data) {\n\n\t            if (window.JSON && window.JSON.parse) {\n\t                return window.JSON.parse(data + '');\n\t            }\n\n\t            var requireNonComma,\n\t                depth = null,\n\t                str = utils.trim(data + '');\n\n\t            return str && !utils.trim(\n\t                str.replace(/(,)|(\\[|{)|(}|])|\"(?:[^\"\\\\\\r\\n]|\\\\[\"\\\\\\/bfnrt]|\\\\u[\\da-fA-F]{4})*\"\\s*:?|true|false|null|-?(?!0\\d)\\d+(?:\\.\\d+|)(?:[eE][+-]?\\d+|)/g\n\t                    , function (token, comma, open, close) {\n\n\t                        if (requireNonComma && comma) {\n\t                            depth = 0;\n\t                        }\n\n\t                        if (depth === 0) {\n\t                            return token;\n\t                        }\n\n\t                        requireNonComma = open || comma;\n\t                        depth += !close - !open;\n\t                        return '';\n\t                    })\n\t            )\n\t                ? (Function('return ' + str))()\n\t                : (Function('Invalid JSON: ' + data))();\n\t        },\n\n\t        parseUploadResponse: function (response) {\n\t            return response.indexOf('callback') > -1 ? //lte ie9\n\t                response.slice(9, -1) : response;\n\t        },\n\n\t        parseDownloadResponse: function (response) {\n\t            return ((response && response.type && response.type === 'application/json')\n\t            || 0 > Object.prototype.toString.call(response).indexOf('Blob'))\n\t                ? this.url + '?token=' : window.URL.createObjectURL(response);\n\t        },\n\n\t        uploadFile: function (options) {\n\t            var options = options || {};\n\t            options.onFileUploadProgress = options.onFileUploadProgress || EMPTYFN;\n\t            options.onFileUploadComplete = options.onFileUploadComplete || EMPTYFN;\n\t            options.onFileUploadError = options.onFileUploadError || EMPTYFN;\n\t            options.onFileUploadCanceled = options.onFileUploadCanceled || EMPTYFN;\n\n\t            var acc = options.accessToken || this.context.accessToken;\n\t            if (!acc) {\n\t                options.onFileUploadError({\n\t                    type: _code.WEBIM_UPLOADFILE_NO_LOGIN\n\t                    , id: options.id\n\t                });\n\t                return;\n\t            }\n\n\t            var orgName, appName, devInfos;\n\t            var appKey = options.appKey || this.context.appKey || '';\n\n\t            if (appKey) {\n\t                devInfos = appKey.split('#');\n\t                orgName = devInfos[0];\n\t                appName = devInfos[1];\n\t            }\n\n\t            if (!orgName && !appName) {\n\t                options.onFileUploadError({\n\t                    type: _code.WEBIM_UPLOADFILE_ERROR\n\t                    , id: options.id\n\t                });\n\t                return;\n\t            }\n\n\t            var apiUrl = options.apiUrl;\n\t            var uploadUrl = apiUrl + '/' + orgName + '/' + appName + '/chatfiles';\n\n\t            if (!utils.isCanUploadFileAsync) {\n\t                if (utils.hasFlash && typeof options.flashUpload === 'function') {\n\t                    options.flashUpload && options.flashUpload(uploadUrl, options);\n\t                } else {\n\t                    options.onFileUploadError({\n\t                        type: _code.WEBIM_UPLOADFILE_BROWSER_ERROR\n\t                        , id: options.id\n\t                    });\n\t                }\n\t                return;\n\t            }\n\n\t            var fileSize = options.file.data ? options.file.data.size : undefined;\n\t            if (fileSize > WEBIM_FILESIZE_LIMIT) {\n\t                options.onFileUploadError({\n\t                    type: _code.WEBIM_UPLOADFILE_ERROR\n\t                    , id: options.id\n\t                });\n\t                return;\n\t            } else if (fileSize <= 0) {\n\t                options.onFileUploadError({\n\t                    type: _code.WEBIM_UPLOADFILE_ERROR\n\t                    , id: options.id\n\t                });\n\t                return;\n\t            }\n\n\t            var xhr = utils.xmlrequest();\n\t            var onError = function (e) {\n\t                options.onFileUploadError({\n\t                    type: _code.WEBIM_UPLOADFILE_ERROR,\n\t                    id: options.id,\n\t                    xhr: xhr\n\t                });\n\t            };\n\t            if (xhr.upload) {\n\t                xhr.upload.addEventListener('progress', options.onFileUploadProgress, false);\n\t            }\n\t            if (xhr.addEventListener) {\n\t                xhr.addEventListener('abort', options.onFileUploadCanceled, false);\n\t                xhr.addEventListener('load', function (e) {\n\t                    try {\n\t                        var json = utils.parseJSON(xhr.responseText);\n\t                        try {\n\t                            options.onFileUploadComplete(json);\n\t                        } catch (e) {\n\t                            options.onFileUploadError({\n\t                                type: _code.WEBIM_CONNCTION_CALLBACK_INNER_ERROR\n\t                                , data: e\n\t                            });\n\t                        }\n\t                    } catch (e) {\n\t                        options.onFileUploadError({\n\t                            type: _code.WEBIM_UPLOADFILE_ERROR,\n\t                            data: xhr.responseText,\n\t                            id: options.id,\n\t                            xhr: xhr\n\t                        });\n\t                    }\n\t                }, false);\n\t                xhr.addEventListener('error', onError, false);\n\t            } else if (xhr.onreadystatechange) {\n\t                xhr.onreadystatechange = function () {\n\t                    if (xhr.readyState === 4) {\n\t                        if (ajax.status === 200) {\n\t                            try {\n\t                                var json = utils.parseJSON(xhr.responseText);\n\t                                options.onFileUploadComplete(json);\n\t                            } catch (e) {\n\t                                options.onFileUploadError({\n\t                                    type: _code.WEBIM_UPLOADFILE_ERROR,\n\t                                    data: xhr.responseText,\n\t                                    id: options.id,\n\t                                    xhr: xhr\n\t                                });\n\t                            }\n\t                        } else {\n\t                            options.onFileUploadError({\n\t                                type: _code.WEBIM_UPLOADFILE_ERROR,\n\t                                data: xhr.responseText,\n\t                                id: options.id,\n\t                                xhr: xhr\n\t                            });\n\t                        }\n\t                    } else {\n\t                        xhr.abort();\n\t                        options.onFileUploadCanceled();\n\t                    }\n\t                }\n\t            }\n\n\t            xhr.open('POST', uploadUrl);\n\n\t            xhr.setRequestHeader('restrict-access', 'true');\n\t            xhr.setRequestHeader('Accept', '*/*');// Android QQ browser has some problem with this attribute.\n\t            xhr.setRequestHeader('Authorization', 'Bearer ' + acc);\n\n\t            var formData = new FormData();\n\t            formData.append('file', options.file.data);\n\t            xhr.send(formData);\n\t        },\n\n\n\t        download: function (options) {\n\t            options.onFileDownloadComplete = options.onFileDownloadComplete || EMPTYFN;\n\t            options.onFileDownloadError = options.onFileDownloadError || EMPTYFN;\n\n\t            var accessToken = options.accessToken || this.context.accessToken;\n\t            if (!accessToken) {\n\t                options.onFileDownloadError({\n\t                    type: _code.WEBIM_DOWNLOADFILE_NO_LOGIN,\n\t                    id: options.id\n\t                });\n\t                return;\n\t            }\n\n\t            var onError = function (e) {\n\t                options.onFileDownloadError({\n\t                    type: _code.WEBIM_DOWNLOADFILE_ERROR,\n\t                    id: options.id,\n\t                    xhr: xhr\n\t                });\n\t            };\n\n\t            if (!utils.isCanDownLoadFile) {\n\t                options.onFileDownloadComplete();\n\t                return;\n\t            }\n\t            var xhr = utils.xmlrequest();\n\t            if ('addEventListener' in xhr) {\n\t                xhr.addEventListener('load', function (e) {\n\t                    options.onFileDownloadComplete(xhr.response, xhr);\n\t                }, false);\n\t                xhr.addEventListener('error', onError, false);\n\t            } else if ('onreadystatechange' in xhr) {\n\t                xhr.onreadystatechange = function () {\n\t                    if (xhr.readyState === 4) {\n\t                        if (ajax.status === 200) {\n\t                            options.onFileDownloadComplete(xhr.response, xhr);\n\t                        } else {\n\t                            options.onFileDownloadError({\n\t                                type: _code.WEBIM_DOWNLOADFILE_ERROR,\n\t                                id: options.id,\n\t                                xhr: xhr\n\t                            });\n\t                        }\n\t                    } else {\n\t                        xhr.abort();\n\t                        options.onFileDownloadError({\n\t                            type: _code.WEBIM_DOWNLOADFILE_ERROR,\n\t                            id: options.id,\n\t                            xhr: xhr\n\t                        });\n\t                    }\n\t                }\n\t            }\n\n\t            var method = options.method || 'GET';\n\t            var resType = options.responseType || 'blob';\n\t            var mimeType = options.mimeType || 'text/plain; charset=x-user-defined';\n\t            xhr.open(method, options.url);\n\t            if (typeof Blob !== 'undefined') {\n\t                xhr.responseType = resType;\n\t            } else {\n\t                xhr.overrideMimeType(mimeType);\n\t            }\n\n\t            var innerHeaer = {\n\t                'X-Requested-With': 'XMLHttpRequest',\n\t                'Accept': 'application/octet-stream',\n\t                'share-secret': options.secret,\n\t                'Authorization': 'Bearer ' + accessToken\n\t            };\n\t            var headers = options.headers || {};\n\t            for (var key in headers) {\n\t                innerHeaer[key] = headers[key];\n\t            }\n\t            for (var key in innerHeaer) {\n\t                if (innerHeaer[key]) {\n\t                    xhr.setRequestHeader(key, innerHeaer[key]);\n\t                }\n\t            }\n\t            xhr.send(null);\n\t        },\n\n\t        parseTextMessage: function (message, faces) {\n\t            if (typeof message !== 'string') {\n\t                return;\n\t            }\n\n\t            if (Object.prototype.toString.call(faces) !== '[object Object]') {\n\t                return {\n\t                    isemoji: false,\n\t                    body: [\n\t                        {\n\t                            type: 'txt',\n\t                            data: message\n\t                        }\n\t                    ]\n\t                };\n\t            }\n\n\t            var receiveMsg = message;\n\t            var emessage = [];\n\t            var expr = /\\[[^[\\]]{2,3}\\]/mg;\n\t            var emoji = receiveMsg.match(expr);\n\n\t            if (!emoji || emoji.length < 1) {\n\t                return {\n\t                    isemoji: false,\n\t                    body: [\n\t                        {\n\t                            type: 'txt',\n\t                            data: message\n\t                        }\n\t                    ]\n\t                };\n\t            }\n\t            var isemoji = false;\n\t            for (var i = 0; i < emoji.length; i++) {\n\t                var tmsg = receiveMsg.substring(0, receiveMsg.indexOf(emoji[i])),\n\t                    existEmoji = WebIM.Emoji.map[emoji[i]];\n\n\t                if (tmsg) {\n\t                    emessage.push({\n\t                        type: 'txt',\n\t                        data: tmsg\n\t                    });\n\t                }\n\t                if (!existEmoji) {\n\t                    emessage.push({\n\t                        type: 'txt',\n\t                        data: emoji[i]\n\t                    });\n\t                    continue;\n\t                }\n\t                var emojiStr = WebIM.Emoji.map ? WebIM.Emoji.path + existEmoji : null;\n\n\t                if (emojiStr) {\n\t                    isemoji = true;\n\t                    emessage.push({\n\t                        type: 'emoji',\n\t                        data: emojiStr\n\t                    });\n\t                } else {\n\t                    emessage.push({\n\t                        type: 'txt',\n\t                        data: emoji[i]\n\t                    });\n\t                }\n\t                var restMsgIndex = receiveMsg.indexOf(emoji[i]) + emoji[i].length;\n\t                receiveMsg = receiveMsg.substring(restMsgIndex);\n\t            }\n\t            if (receiveMsg) {\n\t                emessage.push({\n\t                    type: 'txt',\n\t                    data: receiveMsg\n\t                });\n\t            }\n\t            if (isemoji) {\n\t                return {\n\t                    isemoji: isemoji,\n\t                    body: emessage\n\t                };\n\t            }\n\t            return {\n\t                isemoji: false,\n\t                body: [\n\t                    {\n\t                        type: 'txt',\n\t                        data: message\n\t                    }\n\t                ]\n\t            };\n\t        },\n\n\t        xmlrequest: _xmlrequest,\n\n\n\t        getXmlFirstChild: function (data, tagName) {\n\t            var children = data.getElementsByTagName(tagName);\n\t            if (children.length == 0) {\n\t                return null;\n\t            } else {\n\t                return children[0];\n\t            }\n\t        },\n\t        ajax: function (options) {\n\t            var dataType = options.dataType || 'text';\n\t            var suc = options.success || EMPTYFN;\n\t            var error = options.error || EMPTYFN;\n\t            var xhr = utils.xmlrequest();\n\n\t            xhr.onreadystatechange = function () {\n\t                if (xhr.readyState === 4) {\n\t                    var status = xhr.status || 0;\n\t                    if (status === 200) {\n\t                        try {\n\t                            switch (dataType) {\n\t                                case 'text':\n\t                                    suc(xhr.responseText);\n\t                                    return;\n\t                                case 'json':\n\t                                    var json = utils.parseJSON(xhr.responseText);\n\t                                    suc(json, xhr);\n\t                                    return;\n\t                                case 'xml':\n\t                                    if (xhr.responseXML && xhr.responseXML.documentElement) {\n\t                                        suc(xhr.responseXML.documentElement, xhr);\n\t                                    } else {\n\t                                        error({\n\t                                            type: _code.WEBIM_CONNCTION_AJAX_ERROR,\n\t                                            data: xhr.responseText\n\t                                        });\n\t                                    }\n\t                                    return;\n\t                            }\n\t                            suc(xhr.response || xhr.responseText, xhr);\n\t                        } catch (e) {\n\t                            error({\n\t                                type: _code.WEBIM_CONNCTION_AJAX_ERROR,\n\t                                data: e\n\t                            });\n\t                        }\n\t                        return;\n\t                    } else {\n\t                        error({\n\t                            type: _code.WEBIM_CONNCTION_AJAX_ERROR,\n\t                            data: xhr.responseText\n\t                        });\n\t                        return;\n\t                    }\n\t                }\n\t                if (xhr.readyState === 0) {\n\t                    error({\n\t                        type: _code.WEBIM_CONNCTION_AJAX_ERROR,\n\t                        data: xhr.responseText\n\t                    });\n\t                }\n\t            };\n\n\t            if (options.responseType) {\n\t                if (xhr.responseType) {\n\t                    xhr.responseType = options.responseType;\n\t                }\n\t            }\n\t            if (options.mimeType) {\n\t                if (utils.hasOverrideMimeType) {\n\t                    xhr.overrideMimeType(options.mimeType);\n\t                }\n\t            }\n\n\t            var type = options.type || 'POST',\n\t                data = options.data || null,\n\t                tempData = '';\n\n\t            if (type.toLowerCase() === 'get' && data) {\n\t                for (var o in data) {\n\t                    if (data.hasOwnProperty(o)) {\n\t                        tempData += o + '=' + data[o] + '&';\n\t                    }\n\t                }\n\t                tempData = tempData ? tempData.slice(0, -1) : tempData;\n\t                options.url += (options.url.indexOf('?') > 0 ? '&' : '?') + (tempData ? tempData + '&' : tempData) + '_v=' + new Date().getTime();\n\t                data = null;\n\t                tempData = null;\n\t            }\n\t            xhr.open(type, options.url);\n\n\t            if (utils.isCanSetRequestHeader) {\n\t                var headers = options.headers || {};\n\t                for (var key in headers) {\n\t                    if (headers.hasOwnProperty(key)) {\n\t                        xhr.setRequestHeader(key, headers[key]);\n\t                    }\n\t                }\n\t            }\n\n\t            xhr.send(data);\n\t            return xhr;\n\t        },\n\t        ts: function () {\n\t            var d = new Date();\n\t            var Hours = d.getHours(); //获取当前小时数(0-23)\n\t            var Minutes = d.getMinutes(); //获取当前分钟数(0-59)\n\t            var Seconds = d.getSeconds(); //获取当前秒数(0-59)\n\t            var Milliseconds = d.getMilliseconds(); //获取当前毫秒\n\t            return (Hours < 10 ? \"0\" + Hours : Hours) + ':' + (Minutes < 10 ? \"0\" + Minutes : Minutes) + ':' + (Seconds < 10 ? \"0\" + Seconds : Seconds) + ':' + Milliseconds + ' ';\n\t        },\n\n\t        getObjectKey: function (obj, val) {\n\t            for (var key in obj) {\n\t                if (obj[key] == val) {\n\t                    return key;\n\t                }\n\t            }\n\t            return '';\n\t        }\n\n\t    };\n\n\n\t    exports.utils = utils;\n\t}());\n\n\n/***/ },\n/* 4 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t;(function () {\n\t    'use strict';\n\n\t    var _utils = __webpack_require__(3).utils;\n\t    var Message = function (type, id) {\n\t        if (!this instanceof Message) {\n\t            return new Message(type);\n\t        }\n\n\t        this._msg = {};\n\n\t        if (typeof Message[type] === 'function') {\n\t            Message[type].prototype.setGroup = this.setGroup;\n\t            this._msg = new Message[type](id);\n\t        }\n\t        return this._msg;\n\t    }\n\t    Message.prototype.setGroup = function (group) {\n\t        this.body.group = group;\n\t    }\n\n\n\t    /*\n\t     * text message\n\t     */\n\t    Message.txt = function (id) {\n\t        this.id = id;\n\t        this.type = 'txt';\n\t        this.body = {};\n\t    };\n\t    Message.txt.prototype.set = function (opt) {\n\t        this.value = opt.msg;\n\t        this.body = {\n\t            id: this.id\n\t            , to: opt.to\n\t            , msg: this.value\n\t            , type: this.type\n\t            , roomType: opt.roomType\n\t            , ext: opt.ext || {}\n\t            , success: opt.success\n\t            , fail: opt.fail\n\t        };\n\n\t        !opt.roomType && delete this.body.roomType;\n\n\t    };\n\n\t    /*\n\t     * cmd message\n\t     */\n\t    Message.cmd = function (id) {\n\t        this.id = id;\n\t        this.type = 'cmd';\n\t        this.body = {};\n\t    };\n\t    Message.cmd.prototype.set = function (opt) {\n\t        this.value = '';\n\n\t        this.body = {\n\t            to: opt.to\n\t            , action: opt.action\n\t            , msg: this.value\n\t            , type: this.type\n\t            , roomType: opt.roomType\n\t            , ext: opt.ext || {}\n\t            , success: opt.success\n\t        };\n\t        !opt.roomType && delete this.body.roomType;\n\t    };\n\n\t    /*\n\t     * loc message\n\t     */\n\t    Message.location = function (id) {\n\t        this.id = id;\n\t        this.type = 'loc';\n\t        this.body = {};\n\t    };\n\t    Message.location.prototype.set = function (opt) {\n\t        this.body = {\n\t            to: opt.to\n\t            , type: this.type\n\t            , roomType: opt.roomType\n\t            , addr: opt.addr\n\t            , lat: opt.lat\n\t            , lng: opt.lng\n\t            , ext: opt.ext || {}\n\t        };\n\t    };\n\n\t    /*\n\t     * img message\n\t     */\n\t    Message.img = function (id) {\n\t        this.id = id;\n\t        this.type = 'img';\n\t        this.body = {};\n\t    };\n\t    Message.img.prototype.set = function (opt) {\n\t        opt.file = opt.file || _utils.getFileUrl(opt.fileInputId);\n\n\t        this.value = opt.file;\n\n\t        this.body = {\n\t            id: this.id,\n\t            file: this.value,\n\t            apiUrl: opt.apiUrl,\n\t            to: opt.to,\n\t            type: this.type,\n\t            ext: opt.ext || {},\n\t            roomType: opt.roomType,\n\t            onFileUploadError: opt.onFileUploadError,\n\t            onFileUploadComplete: opt.onFileUploadComplete,\n\t            success: opt.success,\n\t            fail: opt.fail,\n\t            flashUpload: opt.flashUpload,\n\t            width: opt.width,\n\t            height: opt.height,\n\t            body: opt.body,\n\t            uploadError: opt.uploadError,\n\t            uploadComplete: opt.uploadComplete\n\t        };\n\n\t        !opt.roomType && delete this.body.roomType;\n\t    };\n\n\t    /*\n\t     * audio message\n\t     */\n\t    Message.audio = function (id) {\n\t        this.id = id;\n\t        this.type = 'audio';\n\t        this.body = {};\n\t    };\n\t    Message.audio.prototype.set = function (opt) {\n\t        opt.file = opt.file || _utils.getFileUrl(opt.fileInputId);\n\n\t        this.value = opt.file;\n\t        this.filename = opt.filename || this.value.filename;\n\n\t        this.body = {\n\t            id: this.id\n\t            , file: this.value\n\t            , filename: this.filename\n\t            , apiUrl: opt.apiUrl\n\t            , to: opt.to\n\t            , type: this.type\n\t            , ext: opt.ext || {}\n\t            , length: opt.length || 0\n\t            , roomType: opt.roomType\n\t            , file_length: opt.file_length\n\t            , onFileUploadError: opt.onFileUploadError\n\t            , onFileUploadComplete: opt.onFileUploadComplete\n\t            , success: opt.success\n\t            , fail: opt.fail\n\t            , flashUpload: opt.flashUpload\n\t            , body: opt.body\n\t        };\n\t        !opt.roomType && delete this.body.roomType;\n\t    };\n\n\t    /*\n\t     * file message\n\t     */\n\t    Message.file = function (id) {\n\t        this.id = id;\n\t        this.type = 'file';\n\t        this.body = {};\n\t    };\n\t    Message.file.prototype.set = function (opt) {\n\t        opt.file = opt.file || _utils.getFileUrl(opt.fileInputId);\n\n\t        this.value = opt.file;\n\t        this.filename = opt.filename || this.value.filename;\n\n\t        this.body = {\n\t            id: this.id\n\t            , file: this.value\n\t            , filename: this.filename\n\t            , apiUrl: opt.apiUrl\n\t            , to: opt.to\n\t            , type: this.type\n\t            , ext: opt.ext || {}\n\t            , roomType: opt.roomType\n\t            , onFileUploadError: opt.onFileUploadError\n\t            , onFileUploadComplete: opt.onFileUploadComplete\n\t            , success: opt.success\n\t            , fail: opt.fail\n\t            , flashUpload: opt.flashUpload\n\t            , body: opt.body\n\t        };\n\t        !opt.roomType && delete this.body.roomType;\n\t    };\n\n\t    /*\n\t     * video message\n\t     */\n\t    Message.video = function (id) {\n\n\t    };\n\t    Message.video.prototype.set = function (opt) {\n\n\t    };\n\n\t    var _Message = function (message) {\n\n\t        if (!this instanceof _Message) {\n\t            return new _Message(message, conn);\n\t        }\n\n\t        this.msg = message;\n\t    };\n\n\t    _Message.prototype.send = function (conn) {\n\t        var me = this;\n\n\t        var _send = function (message) {\n\n\t            message.ext = message.ext || {};\n\t            message.ext.weichat = message.ext.weichat || {};\n\t            message.ext.weichat.originType = message.ext.weichat.originType || 'webim';\n\n\t            var json = {\n\t                from: conn.context.userId || ''\n\t                , to: message.to\n\t                , bodies: [message.body]\n\t                , ext: message.ext || {}\n\t            };\n\n\t            var jsonstr = _utils.stringify(json);\n\t            var dom = $msg({\n\t                type: message.group || 'chat'\n\t                , to: message.toJid\n\t                , id: message.id\n\t                , xmlns: 'jabber:client'\n\t            }).c('body').t(jsonstr);\n\n\t            if (message.roomType) {\n\t                dom.up().c('roomtype', {xmlns: 'easemob:x:roomtype', type: 'chatroom'});\n\t            }\n\n\t            setTimeout(function () {\n\t                if (typeof _msgHash !== 'undefined' && _msgHash[message.id]) {\n\t                    _msgHash[message.id].msg.fail instanceof Function\n\t                    && _msgHash[message.id].msg.fail(message.id);\n\t                }\n\t            }, 60000);\n\t            conn.sendCommand(dom.tree(), message.id);\n\t        };\n\n\n\t        if (me.msg.file) {\n\t            if (me.msg.body && me.msg.body.url) {// Only send msg\n\t                _send(me.msg);\n\t                return;\n\t            }\n\t            var _tmpComplete = me.msg.onFileUploadComplete;\n\t            var _complete = function (data) {\n\n\t                if (data.entities[0]['file-metadata']) {\n\t                    var file_len = data.entities[0]['file-metadata']['content-length'];\n\t                    me.msg.file_length = file_len;\n\t                    me.msg.filetype = data.entities[0]['file-metadata']['content-type'];\n\t                    if (file_len > 204800) {\n\t                        me.msg.thumbnail = true;\n\t                    }\n\t                }\n\n\t                me.msg.body = {\n\t                    type: me.msg.type || 'file'\n\t                    ,\n\t                    url: ((location.protocol != 'https:' && WebIM.config.isHttpDNS) ? (WebIM.config.apiURL + data.uri.substr(data.uri.indexOf(\"/\", 9))) : data.uri) + '/' + data.entities[0]['uuid']\n\t                    , secret: data.entities[0]['share-secret']\n\t                    , filename: me.msg.file.filename || me.msg.filename\n\t                    , size: {\n\t                        width: me.msg.width || 0\n\t                        , height: me.msg.height || 0\n\t                    }\n\t                    , length: me.msg.length || 0\n\t                    , file_length: me.msg.file_length || 0\n\t                    , filetype: me.msg.filetype\n\t                }\n\n\t                _send(me.msg);\n\t                _tmpComplete instanceof Function && _tmpComplete(data, me.msg.id);\n\t            };\n\n\t            me.msg.onFileUploadComplete = _complete;\n\t            _utils.uploadFile.call(conn, me.msg);\n\t        } else {\n\t            me.msg.body = {\n\t                type: me.msg.type === 'chat' ? 'txt' : me.msg.type\n\t                , msg: me.msg.msg\n\t            };\n\t            if (me.msg.type === 'cmd') {\n\t                me.msg.body.action = me.msg.action;\n\t            } else if (me.msg.type === 'loc') {\n\t                me.msg.body.addr = me.msg.addr;\n\t                me.msg.body.lat = me.msg.lat;\n\t                me.msg.body.lng = me.msg.lng;\n\t            }\n\n\t            _send(me.msg);\n\t        }\n\t    };\n\n\t    exports._msg = _Message;\n\t    exports.message = Message;\n\t}());\n\n\n/***/ },\n/* 5 */\n/***/ function(module, exports) {\n\n\t;(function () {\n\t    function Array_h(length) {\n\t        this.array = length === undefined ? [] : new Array(length);\n\t    }\n\n\t    Array_h.prototype = {\n\t        /**\n\t         * 返回数组长度\n\t         *\n\t         * @return {Number} length [数组长度]\n\t         */\n\t        length: function () {\n\t            return this.array.length;\n\t        },\n\n\t        at: function (index) {\n\t            return this.array[index];\n\t        },\n\n\t        set: function (index, obj) {\n\t            this.array[index] = obj;\n\t        },\n\n\t        /**\n\t         * 向数组的末尾添加一个或多个元素，并返回新的长度。\n\t         *\n\t         * @param  {*} obj [description]\n\t         * @return {Number} length [新数组的长度]\n\t         */\n\t        push: function (obj) {\n\t            return this.array.push(obj);\n\t        },\n\n\t        /**\n\t         * 返回数组中选定的元素\n\t         *\n\t         * @param  {Number} start [开始索引值]\n\t         * @param  {Number} end [结束索引值]\n\t         * @return {Array} newArray  [新的数组]\n\t         */\n\t        slice: function (start, end) {\n\t            return this.array = this.array.slice(start, end);\n\t        },\n\n\t        concat: function (array) {\n\t            this.array = this.array.concat(array);\n\t        },\n\n\t        remove: function (index, count) {\n\t            count = count === undefined ? 1 : count;\n\t            this.array.splice(index, count);\n\t        },\n\n\t        join: function (separator) {\n\t            return this.array.join(separator);\n\t        },\n\n\t        clear: function () {\n\t            this.array.length = 0;\n\t        }\n\t    };\n\n\t    /**\n\t     * 先进先出队列 (First Input First Output)\n\t     *\n\t     * 一种先进先出的数据缓存器\n\t     */\n\t    var Queue = function () {\n\t        this._array_h = new Array_h();\n\t    };\n\n\t    Queue.prototype = {\n\t        _index: 0,\n\n\t        /**\n\t         * 排队\n\t         *\n\t         * @param  {Object} obj [description]\n\t         * @return {[type]}     [description]\n\t         */\n\t        push: function (obj) {\n\t            this._array_h.push(obj);\n\t        },\n\n\t        /**\n\t         * 出队\n\t         *\n\t         * @return {Object} [description]\n\t         */\n\t        pop: function () {\n\t            var ret = null;\n\t            if (this._array_h.length()) {\n\t                ret = this._array_h.at(this._index);\n\t                if (++this._index * 2 >= this._array_h.length()) {\n\t                    this._array_h.slice(this._index);\n\t                    this._index = 0;\n\t                }\n\t            }\n\t            return ret;\n\t        },\n\n\t        /**\n\t         * 返回队列中头部(即最新添加的)的动态对象\n\t         *\n\t         * @return {Object} [description]\n\t         */\n\t        head: function () {\n\t            var ret = null, len = this._array_h.length();\n\t            if (len) {\n\t                ret = this._array_h.at(len - 1);\n\t            }\n\t            return ret;\n\t        },\n\n\t        /**\n\t         * 返回队列中尾部(即最早添加的)的动态对象\n\t         *\n\t         * @return {Object} [description]\n\t         */\n\t        tail: function () {\n\t            var ret = null, len = this._array_h.length();\n\t            if (len) {\n\t                ret = this._array_h.at(this._index);\n\t            }\n\t            return ret;\n\t        },\n\n\t        /**\n\t         * 返回数据队列长度\n\t         *\n\t         * @return {Number} [description]\n\t         */\n\t        length: function () {\n\t            return this._array_h.length() - this._index;\n\t        },\n\n\t        /**\n\t         * 队列是否为空\n\t         *\n\t         * @return {Boolean} [description]\n\t         */\n\t        empty: function () {\n\t            return (this._array_h.length() === 0);\n\t        },\n\n\t        clear: function () {\n\t            this._array_h.clear();\n\t        }\n\t    };\n\t    exports.Queue = Queue;\n\t}());\n\n\n/***/ }\n/******/ ])\n});\n;"]}